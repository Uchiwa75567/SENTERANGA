{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { RouterModule } from '@angular/router';\nimport { HeaderComponent } from '../../components/header/header.component';\nimport { FooterComponent } from '../../components/footer/footer.component';\nimport { ReactiveFormsModule, FormsModule, Validators } from '@angular/forms';\nlet DashboardAgriculteurComponent = class DashboardAgriculteurComponent {\n  constructor(dataService, fb) {\n    this.dataService = dataService;\n    this.fb = fb;\n    // Data\n    this.notifications = [];\n    this.products = [];\n    this.seeds = [];\n    this.seedOrderQty = {};\n    this.alerts = [];\n    this.currentUser = null;\n    this.uploadedImageCount = 0;\n    this.selectedImages = [];\n  }\n  ngOnInit() {\n    const raw = localStorage.getItem('currentUser');\n    this.currentUser = raw ? JSON.parse(raw) : null;\n    // Initialize forms\n    this.productForm = this.fb.group({\n      titre: ['', Validators.required],\n      description: ['', Validators.required],\n      categorie: ['', Validators.required],\n      quantite: ['', [Validators.required, Validators.min(1)]],\n      prix: ['', [Validators.required, Validators.min(0)]],\n      unite: ['', Validators.required],\n      localisation: ['', Validators.required]\n    });\n    this.bankForm = this.fb.group({\n      bankName: [''],\n      accountNumber: ['']\n    });\n    this.loadInitial();\n  }\n  loadInitial() {\n    if (!this.currentUser) return;\n    // Load notifications\n    this.dataService.getNotificationsForUser(this.currentUser.id).subscribe(list => this.notifications = list || []);\n    // Load user's products\n    this.dataService.getProductsByUser(this.currentUser.id).subscribe(list => this.products = list || []);\n    // Load seeds catalog\n    this.dataService.getSeedsCatalog().subscribe(list => {\n      this.seeds = list || [];\n      this.seeds.forEach(s => this.seedOrderQty[s.id] = 1);\n    });\n    // Load alerts filtered by region\n    if (this.currentUser.region) {\n      this.dataService.getAlertsByRegion(this.currentUser.region).subscribe(list => this.alerts = list || []);\n    }\n    // Bank info prefill\n    if (this.currentUser.bankAccount) {\n      this.bankForm.patchValue(this.currentUser.bankAccount);\n    }\n  }\n  // Handle image file selection\n  onImagesSelected(event) {\n    this.selectedImages = Array.from(event.target.files || []);\n    this.uploadedImageCount = this.selectedImages.length;\n  }\n  // Publish product\n  publishProduct() {\n    if (!this.productForm.valid || !this.currentUser) {\n      alert('Veuillez remplir tous les champs obligatoires');\n      return;\n    }\n    // Convert images to base64 (simplified; for production use proper file upload)\n    this.convertImagesToBase64(this.selectedImages).then(base64Images => {\n      const product = {\n        id: `prod-${Date.now()}`,\n        agriculteurId: this.currentUser.id,\n        titre: this.productForm.value.titre,\n        description: this.productForm.value.description,\n        categorie: this.productForm.value.categorie,\n        quantite: parseFloat(this.productForm.value.quantite),\n        prix: parseFloat(this.productForm.value.prix),\n        unite: this.productForm.value.unite,\n        localisation: this.productForm.value.localisation,\n        images: base64Images,\n        statutValidation: 'en_attente',\n        statutDisponibilite: 'disponible',\n        datePublication: new Date().toISOString(),\n        dateMaj: new Date().toISOString()\n      };\n      this.dataService.createProduct(product).subscribe({\n        next: created => {\n          this.products.unshift(created);\n          alert('Produit publié — en attente de validation');\n          this.resetProductForm();\n        },\n        error: err => {\n          console.error('Error publishing product', err);\n          alert('Erreur lors de la publication du produit');\n        }\n      });\n    });\n  }\n  // Reset product form and image selection\n  resetProductForm() {\n    this.productForm.reset();\n    this.selectedImages = [];\n    this.uploadedImageCount = 0;\n  }\n  // Convert files to base64\n  convertImagesToBase64(files) {\n    return Promise.all(files.map(file => {\n      return new Promise(resolve => {\n        const reader = new FileReader();\n        reader.onload = () => {\n          resolve(reader.result);\n        };\n        reader.readAsDataURL(file);\n      });\n    }));\n  }\n  // Bank account save\n  saveBankAccount() {\n    if (!this.currentUser) return;\n    const bank = this.bankForm.value;\n    const payload = {\n      bankName: bank.bankName || '',\n      accountNumber: bank.accountNumber || ''\n    };\n    this.dataService.updateUserBankAccount(this.currentUser.id, payload).subscribe({\n      next: u => {\n        this.currentUser = u;\n        localStorage.setItem('currentUser', JSON.stringify(u));\n        alert('Compte bancaire enregistré');\n      },\n      error: err => {\n        console.error(err);\n        alert('Erreur lors de l\\'enregistrement');\n      }\n    });\n  }\n  // Order seed\n  orderSeed(seed) {\n    if (!this.currentUser) return;\n    const qty = this.seedOrderQty[seed.id] || 1;\n    const order = {\n      id: `order-${Date.now()}`,\n      userId: this.currentUser.id,\n      seedId: seed.id,\n      seedName: seed.name,\n      quantity: qty,\n      total: (seed.price || 0) * qty,\n      status: 'paid',\n      createdAt: new Date().toISOString()\n    };\n    this.dataService.createSeedOrder(order).subscribe({\n      next: res => {\n        alert(`Commande passée: ${order.seedName} x${qty}`);\n      },\n      error: err => {\n        console.error(err);\n        alert('Erreur lors de la commande');\n      }\n    });\n  }\n};\nDashboardAgriculteurComponent = __decorate([Component({\n  selector: 'app-dashboard-agriculteur',\n  standalone: true,\n  imports: [CommonModule, RouterModule, HeaderComponent, FooterComponent, ReactiveFormsModule, FormsModule],\n  templateUrl: './dashboard-agriculteur.component.html'\n})], DashboardAgriculteurComponent);\nexport { DashboardAgriculteurComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}