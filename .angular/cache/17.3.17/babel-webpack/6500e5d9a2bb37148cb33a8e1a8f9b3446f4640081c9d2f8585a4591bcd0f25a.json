{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ReactiveFormsModule, Validators } from '@angular/forms';\nimport { RouterLink } from '@angular/router';\nlet RegisterComponent = class RegisterComponent {\n  constructor(fb, router) {\n    this.fb = fb;\n    this.router = router;\n    this.selectedUserType = null;\n    this.isLoading = false;\n    this.currentStep = 1;\n    this.totalSteps = 2;\n    // Image previews\n    this.idCardRectoPreview = null;\n    this.idCardVersoPreview = null;\n    this.userTypes = [{\n      value: 'agriculteur',\n      label: 'Agriculteur/Producteur',\n      description: 'Producteurs agricoles, Ã©leveurs, pÃªcheurs',\n      icon: 'ðŸŒ¾'\n    }, {\n      value: 'client',\n      label: 'Client Acheteur',\n      description: 'Particuliers, commerÃ§ants, grossistes',\n      icon: 'ðŸ›’'\n    }, {\n      value: 'investisseur',\n      label: 'Investisseur Agricole',\n      description: 'Investisseurs particuliers ou entreprises',\n      icon: 'ðŸ’°'\n    }, {\n      value: 'agronome',\n      label: 'Agronome/Conseiller',\n      description: 'Conseillers agricoles, techniciens, ONG',\n      icon: 'ðŸ‘¨â€ðŸ”¬'\n    }];\n    this.regions = ['Dakar', 'ThiÃ¨s', 'Saint-Louis', 'Kaolack', 'Ziguinchor', 'Louga', 'Matam', 'Kolda', 'Tambacounda', 'Fatick', 'Kaffrine', 'KÃ©dougou', 'SÃ©dhiou', 'Diourbel'];\n    this.clientTypes = [{\n      value: 'famille',\n      label: 'Moi / ma famille'\n    }, {\n      value: 'boutique',\n      label: 'Ma boutique / restaurant'\n    }, {\n      value: 'commerce',\n      label: 'Mon commerce en gros'\n    }];\n    this.investorTypes = [{\n      value: 'particulier',\n      label: 'Particulier'\n    }, {\n      value: 'entreprise',\n      label: 'Entreprise / Fonds'\n    }];\n    this.registrationForm = this.createForm();\n  }\n  selectUserType(userType) {\n    this.selectedUserType = userType;\n    this.registrationForm = this.createForm();\n    this.setValidatorsForUserType(userType);\n  }\n  setValidatorsForUserType(userType) {\n    // Clear all validators first\n    this.clearValidators();\n    // ID Card is required for agriculteur, client, and agronome\n    if (userType === 'agriculteur' || userType === 'client' || userType === 'agronome') {\n      this.registrationForm.get('idCardRecto')?.setValidators(Validators.required);\n      this.registrationForm.get('idCardVerso')?.setValidators(Validators.required);\n    }\n    // Set validators based on user type\n    if (userType === 'agriculteur') {\n      this.registrationForm.get('region')?.setValidators(Validators.required);\n      this.registrationForm.get('departement')?.setValidators(Validators.required);\n      this.registrationForm.get('village')?.setValidators(Validators.required);\n    } else if (userType === 'client') {\n      this.registrationForm.get('clientType')?.setValidators(Validators.required);\n    } else if (userType === 'investisseur') {\n      this.registrationForm.get('email')?.setValidators([Validators.required, Validators.email]);\n      this.registrationForm.get('investorType')?.setValidators(Validators.required);\n      this.registrationForm.get('montantInvestissement')?.setValidators([Validators.required, Validators.min(100000)]);\n    } else if (userType === 'agronome') {\n      this.registrationForm.get('emailPro')?.setValidators(Validators.email);\n      this.registrationForm.get('telephonePro')?.setValidators(Validators.pattern(/^(\\+221|221)?[76|77|78|33|70|76|77|78][0-9]{7}$/));\n      this.registrationForm.get('structure')?.setValidators(Validators.required);\n      this.registrationForm.get('regionsIntervention')?.setValidators(Validators.required);\n    }\n    // Update validity\n    this.registrationForm.updateValueAndValidity();\n  }\n  clearValidators() {\n    ['idCardRecto', 'idCardVerso', 'region', 'departement', 'village', 'clientType', 'email', 'investorType', 'montantInvestissement', 'emailPro', 'telephonePro', 'structure', 'regionsIntervention'].forEach(field => {\n      this.registrationForm.get(field)?.clearValidators();\n      this.registrationForm.get(field)?.updateValueAndValidity();\n    });\n  }\n  createForm() {\n    return this.fb.group({\n      userType: [this.selectedUserType],\n      prenom: ['', [Validators.required, Validators.minLength(2)]],\n      nom: ['', [Validators.required, Validators.minLength(2)]],\n      telephone: ['', [Validators.required, Validators.pattern(/^(\\+221|221)?[76|77|78|33|70|76|77|78][0-9]{7}$/)]],\n      // ID Card fields (required for agriculteur, client, agronome)\n      idCardRecto: [null],\n      idCardVerso: [null],\n      // Agriculteur fields\n      region: [''],\n      departement: [''],\n      village: [''],\n      // Client fields\n      clientType: [''],\n      // Investisseur fields\n      email: [''],\n      investorType: [''],\n      montantInvestissement: [''],\n      // Agronome fields\n      emailPro: [''],\n      telephonePro: [''],\n      structure: [''],\n      regionsIntervention: [[]]\n    });\n  }\n  onSubmit() {\n    if (this.registrationForm.valid) {\n      this.isLoading = true;\n      const formValue = this.registrationForm.value;\n      // Simulate registration API call\n      setTimeout(() => {\n        console.log('Registration attempt:', formValue);\n        // For demo purposes, just navigate to login\n        this.router.navigate(['/connexion']);\n        this.isLoading = false;\n      }, 2000);\n    } else {\n      // Mark all fields as touched to show validation errors\n      this.registrationForm.markAllAsTouched();\n    }\n  }\n  goBack() {\n    this.selectedUserType = null;\n    this.registrationForm = this.createForm();\n  }\n  onRegionChange(region, event) {\n    const target = event.target;\n    const checked = target.checked;\n    const currentRegions = this.registrationForm.get('regionsIntervention')?.value || [];\n    let updatedRegions;\n    if (checked) {\n      updatedRegions = [...currentRegions, region];\n    } else {\n      updatedRegions = currentRegions.filter(r => r !== region);\n    }\n    this.registrationForm.get('regionsIntervention')?.setValue(updatedRegions);\n  }\n  isRegionSelected(region) {\n    const selectedRegions = this.registrationForm.get('regionsIntervention')?.value || [];\n    return selectedRegions.includes(region);\n  }\n  // File handling methods\n  onFileChange(event, fieldName) {\n    const target = event.target;\n    const file = target.files?.[0];\n    if (file) {\n      // Validate file type (images only)\n      const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];\n      if (!allowedTypes.includes(file.type)) {\n        alert('Veuillez sÃ©lectionner un fichier image valide (JPEG, PNG, GIF)');\n        target.value = '';\n        return;\n      }\n      // Validate file size (max 5MB)\n      const maxSize = 5 * 1024 * 1024; // 5MB\n      if (file.size > maxSize) {\n        alert('La taille du fichier ne doit pas dÃ©passer 5MB');\n        target.value = '';\n        return;\n      }\n      // Set file in form\n      this.registrationForm.get(fieldName)?.setValue(file);\n      // Generate preview URL\n      const reader = new FileReader();\n      reader.onload = e => {\n        if (fieldName === 'idCardRecto') {\n          this.idCardRectoPreview = e.target?.result;\n        } else if (fieldName === 'idCardVerso') {\n          this.idCardVersoPreview = e.target?.result;\n        }\n      };\n      reader.readAsDataURL(file);\n    }\n  }\n  // Remove file and preview\n  removeFile(fieldName) {\n    this.registrationForm.get(fieldName)?.setValue(null);\n    if (fieldName === 'idCardRecto') {\n      this.idCardRectoPreview = null;\n      const input = document.getElementById('idCardRecto');\n      if (input) input.value = '';\n    } else if (fieldName === 'idCardVerso') {\n      this.idCardVersoPreview = null;\n      const input = document.getElementById('idCardVerso');\n      if (input) input.value = '';\n    }\n  }\n  // Getters for form controls\n  get prenom() {\n    return this.registrationForm.get('prenom');\n  }\n  get nom() {\n    return this.registrationForm.get('nom');\n  }\n  get telephone() {\n    return this.registrationForm.get('telephone');\n  }\n  get idCardRecto() {\n    return this.registrationForm.get('idCardRecto');\n  }\n  get idCardVerso() {\n    return this.registrationForm.get('idCardVerso');\n  }\n  get email() {\n    return this.registrationForm.get('email');\n  }\n  get region() {\n    return this.registrationForm.get('region');\n  }\n  get departement() {\n    return this.registrationForm.get('departement');\n  }\n  get village() {\n    return this.registrationForm.get('village');\n  }\n  get clientType() {\n    return this.registrationForm.get('clientType');\n  }\n  get investorType() {\n    return this.registrationForm.get('investorType');\n  }\n  get montantInvestissement() {\n    return this.registrationForm.get('montantInvestissement');\n  }\n  get emailPro() {\n    return this.registrationForm.get('emailPro');\n  }\n  get telephonePro() {\n    return this.registrationForm.get('telephonePro');\n  }\n  get structure() {\n    return this.registrationForm.get('structure');\n  }\n  get regionsIntervention() {\n    return this.registrationForm.get('regionsIntervention');\n  }\n};\nRegisterComponent = __decorate([Component({\n  selector: 'app-register',\n  standalone: true,\n  imports: [CommonModule, ReactiveFormsModule, RouterLink],\n  templateUrl: './register.component.html'\n})], RegisterComponent);\nexport { RegisterComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}