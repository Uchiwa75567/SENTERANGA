"use strict";(self.webpackChunksenteranga=self.webpackChunksenteranga||[]).push([[195],{7195:(y,f,o)=>{o.r(f),o.d(f,{LoginComponent:()=>b});var v=o(177),a=o(4341),h=o(5776),E=o(8032),_=o.n(E),e=o(4438),U=o(8490);function m(i,c){1&i&&(e.j41(0,"div"),e.EFF(1,"Le num\xe9ro de t\xe9l\xe9phone est requis"),e.k0s())}function x(i,c){1&i&&(e.j41(0,"div"),e.EFF(1,"Format invalide (ex: 771234567)"),e.k0s())}function t(i,c){if(1&i&&(e.j41(0,"div",28),e.DNE(1,m,2,0,"div",24)(2,x,2,0,"div",24),e.k0s()),2&i){const l=e.XpG();e.R7$(),e.Y8G("ngIf",null==l.telephone||null==l.telephone.errors?null:l.telephone.errors.required),e.R7$(),e.Y8G("ngIf",null==l.telephone||null==l.telephone.errors?null:l.telephone.errors.pattern)}}function r(i,c){1&i&&(e.j41(0,"div"),e.EFF(1,"Le mot de passe est requis"),e.k0s())}function d(i,c){1&i&&(e.j41(0,"div"),e.EFF(1,"Le mot de passe doit contenir exactement 6 chiffres"),e.k0s())}function p(i,c){if(1&i&&(e.j41(0,"div",28),e.DNE(1,r,2,0,"div",24)(2,d,2,0,"div",24),e.k0s()),2&i){const l=e.XpG();e.R7$(),e.Y8G("ngIf",null==l.password||null==l.password.errors?null:l.password.errors.required),e.R7$(),e.Y8G("ngIf",null==l.password||null==l.password.errors?null:l.password.errors.pattern)}}function s(i,c){1&i&&(e.j41(0,"span",29),e.qSk(),e.j41(1,"svg",30),e.nrm(2,"circle",31)(3,"path",32),e.k0s(),e.EFF(4," Connexion... "),e.k0s())}function u(i,c){1&i&&(e.j41(0,"span"),e.EFF(1,"Se connecter"),e.k0s())}let b=(()=>{class i{constructor(l,g,n){this.fb=l,this.router=g,this.dataService=n,this.isLoading=!1,this.loginForm=this.fb.group({telephone:["",[a.k0.required,a.k0.pattern(/^(\+221|221)?(77|76|78|75|70)[0-9]{7}$/)]],password:["",[a.k0.required,a.k0.pattern(/^[0-9]{6}$/)]],rememberMe:[!1]})}onSubmit(){if(this.loginForm.valid){this.isLoading=!0;const{telephone:l,password:g}=this.loginForm.value;this.dataService.authenticateUser(l,g).subscribe(n=>{if(n){if(console.log("Login successful:",n),"agriculteur"===n.userType&&"approved"!==n.validationStatus&&!0!==n.isValidated)return"rejected"===n.validationStatus?_().fire({icon:"error",title:"Inscription rejet\xe9e",text:"Votre inscription a \xe9t\xe9 rejet\xe9e. Contactez le support pour plus d'informations.",confirmButtonColor:"#22c55e"}):_().fire({icon:"warning",title:"Validation en attente",text:"Votre compte est en attente de validation par l'administration. Vous recevrez une notification une fois trait\xe9.",confirmButtonColor:"#22c55e"}),void(this.isLoading=!1);localStorage.setItem("currentUser",JSON.stringify(n)),this.router.navigate([{agriculteur:"/dashboard-agriculteur",client:"/dashboard-institutionnel",admin:"/dashboard-admin",investisseur:"/dashboard-institutionnel",agronome:"/dashboard-institutionnel","agent-terrain":"/dashboard-institutionnel",etat:"/dashboard-institutionnel"}[n.userType]||"/dashboard-institutionnel"])}else console.log("Login failed: Invalid credentials"),_().fire({icon:"error",title:"Connexion \xe9chou\xe9e",text:"Num\xe9ro de t\xe9l\xe9phone ou mot de passe incorrect",confirmButtonColor:"#22c55e"});this.isLoading=!1})}else this.loginForm.markAllAsTouched()}get telephone(){return this.loginForm.get("telephone")}get password(){return this.loginForm.get("password")}get email(){return this.loginForm.get("email")}static{this.\u0275fac=function(g){return new(g||i)(e.rXU(a.ok),e.rXU(h.Ix),e.rXU(U.u))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-login"]],standalone:!0,features:[e.aNF],decls:40,vars:10,consts:[[1,"absolute","top-8","left-8","z-20"],["routerLink","/",1,"flex","items-center","gap-2","text-white","hover:text-senteranga-green","transition-colors"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"font-medium"],[1,"relative","min-h-screen","flex","flex-col","justify-center","items-center","px-8","py-20","pt-20",2,"background","linear-gradient(180deg, rgba(102,102,102,0.08) 0%, rgba(0,0,0,0.7) 43.75%, rgba(0,0,0,0.7) 100%), url('https://images.unsplash.com/photo-1542838132-92c53300491e?w=1920&q=80') center/cover no-repeat"],[1,"max-w-md","w-full","z-10"],[1,"bg-white/95","backdrop-blur-sm","rounded-2xl","shadow-2xl","p-8"],[1,"text-center","mb-8"],[1,"text-4xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"space-y-6",3,"ngSubmit","formGroup"],["for","telephone",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","tel","id","telephone","formControlName","telephone","placeholder","77 XXX XX XX",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-senteranga-green","focus:border-transparent","outline-none","transition-colors"],["class","mt-1 text-sm text-red-600",4,"ngIf"],["for","password",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","password","id","password","formControlName","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022","maxlength","6",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-senteranga-green","focus:border-transparent","outline-none","transition-colors"],[1,"flex","items-center","justify-between"],[1,"flex","items-center"],["type","checkbox","id","rememberMe","formControlName","rememberMe",1,"h-4","w-4","text-senteranga-green","focus:ring-senteranga-green","border-gray-300","rounded"],["for","rememberMe",1,"ml-2","block","text-sm","text-gray-700"],["href","#",1,"text-sm","text-senteranga-green","hover:text-senteranga-green-dark"],["type","submit",1,"w-full","bg-senteranga-green","text-white","py-3","px-4","rounded-lg","hover:bg-senteranga-green-dark","focus:ring-2","focus:ring-offset-2","focus:ring-senteranga-green","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],["class","inline-flex items-center",4,"ngIf"],[4,"ngIf"],[1,"mt-6","text-center"],[1,"text-gray-600","mb-4"],["routerLink","/inscription",1,"bg-senteranga-green","text-white","py-3","px-6","rounded-lg","hover:bg-senteranga-green-dark","focus:ring-2","focus:ring-offset-2","focus:ring-senteranga-green","transition-colors"],[1,"mt-1","text-sm","text-red-600"],[1,"inline-flex","items-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-3","h-5","w-5","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(g,n){1&g&&(e.j41(0,"div",0)(1,"a",1),e.qSk(),e.j41(2,"svg",2),e.nrm(3,"path",3),e.k0s(),e.joV(),e.j41(4,"span",4),e.EFF(5,"Retour au portail"),e.k0s()()(),e.j41(6,"section",5)(7,"div",6)(8,"div",7)(9,"div",8)(10,"h1",9),e.EFF(11,"Connexion"),e.k0s(),e.j41(12,"p",10),e.EFF(13,"Acc\xe9dez \xe0 votre compte SENTERANGA"),e.k0s()(),e.j41(14,"form",11),e.bIt("ngSubmit",function(){return n.onSubmit()}),e.j41(15,"div")(16,"label",12),e.EFF(17," Num\xe9ro de t\xe9l\xe9phone "),e.k0s(),e.nrm(18,"input",13),e.DNE(19,t,3,2,"div",14),e.k0s(),e.j41(20,"div")(21,"label",15),e.EFF(22," Mot de passe (6 chiffres) "),e.k0s(),e.nrm(23,"input",16),e.DNE(24,p,3,2,"div",14),e.k0s(),e.j41(25,"div",17)(26,"div",18),e.nrm(27,"input",19),e.j41(28,"label",20),e.EFF(29," Se souvenir de moi "),e.k0s()(),e.j41(30,"a",21),e.EFF(31," Mot de passe oubli\xe9? "),e.k0s()(),e.j41(32,"button",22),e.DNE(33,s,5,0,"span",23)(34,u,2,0,"span",24),e.k0s()()(),e.j41(35,"div",25)(36,"p",26),e.EFF(37," Pas encore de compte? "),e.k0s(),e.j41(38,"button",27),e.EFF(39," S'inscrire "),e.k0s()()()()),2&g&&(e.R7$(14),e.Y8G("formGroup",n.loginForm),e.R7$(4),e.AVh("border-red-500",(null==n.telephone?null:n.telephone.invalid)&&(null==n.telephone?null:n.telephone.touched)),e.R7$(),e.Y8G("ngIf",(null==n.telephone?null:n.telephone.invalid)&&(null==n.telephone?null:n.telephone.touched)),e.R7$(4),e.AVh("border-red-500",(null==n.password?null:n.password.invalid)&&(null==n.password?null:n.password.touched)),e.R7$(),e.Y8G("ngIf",(null==n.password?null:n.password.invalid)&&(null==n.password?null:n.password.touched)),e.R7$(8),e.Y8G("disabled",n.isLoading),e.R7$(),e.Y8G("ngIf",n.isLoading),e.R7$(),e.Y8G("ngIf",!n.isLoading))},dependencies:[v.MD,v.bT,a.X1,a.qT,a.me,a.Zm,a.BC,a.cb,a.tU,a.j4,a.JD,h.Wk],encapsulation:2})}}return i})()},8490:(y,f,o)=>{o.d(f,{u:()=>U});var v=o(5312),a=o(7673),h=o(6354),E=o(9437),_=o(4438),e=o(1626);let U=(()=>{class m{constructor(t){this.http=t,this.apiUrl=v.c.apiUrl}getRegions(){return this.http.get(`${this.apiUrl}/regions`)}updateUser(t){return this.http.put(`${this.apiUrl}/users/${t.id}`,t)}createNotification(t){return this.http.post(`${this.apiUrl}/notifications`,t)}getUserTypes(){return this.http.get(`${this.apiUrl}/userTypes`)}getClientTypes(){return this.http.get(`${this.apiUrl}/clientTypes`)}getInvestorTypes(){return this.http.get(`${this.apiUrl}/investorTypes`)}getMinistries(){return this.http.get(`${this.apiUrl}/ministries`)}getStructures(){return this.http.get(`${this.apiUrl}/structures`)}getCertifications(){return this.http.get(`${this.apiUrl}/certifications`)}getTestUsers(){return this.http.get(`${this.apiUrl}/users`)}authenticateUser(t,r){const d=t.replace(/^(\+221|221)/,""),p=this.getRegisteredUsersFromStorage();return this.getTestUsers().pipe((0,h.T)(s=>s.find(i=>(i.phone||"").toString().replace(/^(\+221|221)/,"")===d&&i.password===r)||p.find(i=>(i.phone||"").toString().replace(/^(\+221|221)/,"")===d&&i.password===r)||null))}registerUser(t){const r=t.telephone.replace(/^(\+221|221)/,"");return this.getTestUsers().pipe((0,h.T)(d=>{if(d.find(u=>u.phone.replace(/^(\+221|221)/,"")===r))return{success:!1,error:"Un compte avec ce num\xe9ro de t\xe9l\xe9phone existe d\xe9j\xe0"};const s={id:`user-${Date.now()}`,email:t.email||"",password:t.password,userType:t.userType.id,firstName:t.prenom,lastName:t.nom,phone:t.telephone,region:t.region||void 0,department:t.departement||t.department||void 0,village:t.village||void 0,clientType:t.clientType||void 0,investorType:t.investorType||void 0,investmentAmount:t.montantInvestissement||void 0,professionalEmail:t.emailPro||void 0,structure:t.structure||void 0,interventionRegions:t.regionsIntervention||void 0,governmentId:t.governmentId||void 0,ministry:t.ministry||void 0,agentCode:t.agentCode||void 0,adminCode:t.adminCode||void 0,isValidated:!1,validationStatus:"pending",bankAccount:void 0};return this.http.post(`${this.apiUrl}/users`,s).subscribe({next:u=>{console.log("User registered successfully:",u)},error:u=>{console.error("Error saving user:",u)}}),{success:!0,user:s}}))}getRegisteredUsersFromStorage(){const t=localStorage.getItem("registeredUsers");return t?JSON.parse(t):[]}getDepartementsByRegion(t){return this.getRegions().pipe((0,h.T)(r=>{const d=r.find(p=>p.id===t);return d?d.departements:[]}))}createAnnouncement(t){return this.http.post(`${this.apiUrl}/announcements`,t)}getAnnouncementsByUser(t){return this.http.get(`${this.apiUrl}/announcements?userId=${t}`)}getNotificationsForUser(t){return this.http.get(`${this.apiUrl}/notifications?userId=${t}&_sort=createdAt&_order=desc`)}markNotificationRead(t){return this.http.patch(`${this.apiUrl}/notifications/${t}`,{read:!0})}updateUserBankAccount(t,r){return this.http.patch(`${this.apiUrl}/users/${t}`,{bankAccount:r})}getSeedsCatalog(){return this.http.get(`${this.apiUrl}/seeds`).pipe((0,E.W)(t=>(console.warn("seeds endpoint missing or error",t),(0,a.of)([]))))}createSeedOrder(t){return this.http.post(`${this.apiUrl}/seedOrders`,t)}getAlertsByRegion(t){return this.http.get(`${this.apiUrl}/agronomeAlerts?region=${t}`)}createProduct(t){return this.http.post(`${this.apiUrl}/products`,t)}getProductsByUser(t){return this.http.get(`${this.apiUrl}/products?agriculteurId=${t}`)}getProductsByCategory(t){return this.http.get(`${this.apiUrl}/products?categorie=${t}`)}getProductById(t){return this.http.get(`${this.apiUrl}/products/${t}`)}updateProduct(t){return this.http.put(`${this.apiUrl}/products/${t.id}`,t)}updateProductStatus(t,r,d){const p={statutValidation:r,dateMaj:(new Date).toISOString()};return d&&(p.statutDisponibilite=d),this.http.patch(`${this.apiUrl}/products/${t}`,p)}deleteProduct(t){return this.http.delete(`${this.apiUrl}/products/${t}`)}getAllProducts(){return this.http.get(`${this.apiUrl}/products`)}validateUserRegistration(t,r){return this.getUserTypes().pipe((0,h.T)(d=>{const p=d.find(u=>u.id===t);if(!p)return{valid:!1,errors:["Type d'utilisateur invalide"]};const s=[];return p.requiredFields.forEach(u=>{r[u]||s.push(`Le champ ${u} est requis`)}),"agriculteur"===t&&(r.region||s.push("La r\xe9gion est requise"),r.departement||s.push("Le d\xe9partement est requis"),r.village||s.push("Le village est requis")),"client"===t&&(r.clientType||s.push("Le type de client est requis")),"investisseur"===t&&((!r.email||!this.isValidEmail(r.email))&&s.push("Email invalide"),r.investorType||s.push("Le type d'investisseur est requis"),(!r.montantInvestissement||r.montantInvestissement<1e5)&&s.push("Montant minimum: 100 000 FCFA")),"agronome"===t&&((!r.emailPro||!this.isValidEmail(r.emailPro))&&s.push("Email professionnel invalide"),r.structure||s.push("La structure est requise"),(!r.regionsIntervention||0===r.regionsIntervention.length)&&s.push("Au moins une r\xe9gion d'intervention requise")),{valid:0===s.length,errors:s}}))}isValidEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}static{this.\u0275fac=function(r){return new(r||m)(_.KVO(e.Qq))}}static{this.\u0275prov=_.jDH({token:m,factory:m.\u0275fac,providedIn:"root"})}}return m})()},5312:(y,f,o)=>{o.d(f,{c:()=>v});const v={production:!1,apiUrl:"https://json-server-senteranga.onrender.com/api"}}}]);