{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { RouterModule } from '@angular/router';\nimport { HeaderComponent } from '../../components/header/header.component';\nimport { FooterComponent } from '../../components/footer/footer.component';\nimport { ReactiveFormsModule, FormsModule } from '@angular/forms';\nlet DashboardAgriculteurComponent = class DashboardAgriculteurComponent {\n  constructor(dataService, fb) {\n    this.dataService = dataService;\n    this.fb = fb;\n    // Data bindings\n    this.notifications = [];\n    this.announcements = [];\n    this.products = [];\n    this.seeds = [];\n    this.seedOrderQty = {};\n    this.alerts = [];\n    this.currentUser = null;\n    this.categories = ['Légumes', 'Fruits', 'Céréales', 'Bétail', 'Lait', 'Autres'];\n    this.unites = ['kg', 'tonne', 'litre', 'unité', 'panier', 'sac'];\n  }\n  ngOnInit() {\n    const raw = localStorage.getItem('currentUser');\n    this.currentUser = raw ? JSON.parse(raw) : null;\n    // Initialize forms\n    this.bankForm = this.fb.group({\n      bankName: [''],\n      accountNumber: ['']\n    });\n    this.publishForm = this.fb.group({\n      title: [''],\n      description: ['']\n    });\n    this.productForm = this.fb.group({\n      titre: [''],\n      description: [''],\n      categorie: [''],\n      quantite: [0],\n      prix: [0],\n      unite: ['kg'],\n      localisation: [''],\n      images: [''] // comma-separated or single\n    });\n    this.loadInitial();\n  }\n  loadInitial() {\n    if (!this.currentUser) return;\n    // Notifications\n    this.dataService.getNotificationsForUser(this.currentUser.id).subscribe(list => this.notifications = list || []);\n    // Announcements by user\n    this.dataService.getAnnouncementsByUser(this.currentUser.id).subscribe(list => this.announcements = list || []);\n    // Products by user\n    this.dataService.getProductsByUser(this.currentUser.id).subscribe(list => this.products = list || []);\n    // Seeds catalog\n    this.dataService.getSeedsCatalog().subscribe(list => {\n      this.seeds = list || [];\n      this.seeds.forEach(s => this.seedOrderQty[s.id] = 1);\n    });\n    // Alerts filtered by region\n    if (this.currentUser.region) {\n      this.dataService.getAlertsByRegion(this.currentUser.region).subscribe(list => this.alerts = list || []);\n    }\n    // Bank info prefill\n    if (this.currentUser.bankAccount) {\n      this.bankForm.patchValue(this.currentUser.bankAccount);\n    }\n  }\n  // Publish a product listing\n  publishProduct() {\n    if (!this.currentUser || !this.productForm.valid) {\n      alert('Veuillez remplir tous les champs requis');\n      return;\n    }\n    const formValue = this.productForm.value;\n    const now = new Date().toISOString();\n    // Parse images (simple comma-separated for now)\n    const imagesStr = formValue.images || '';\n    const images = imagesStr ? imagesStr.split(',').map(s => s.trim()).filter(s => s) : [];\n    const product = {\n      id: `prod-${Date.now()}`,\n      agriculteurId: this.currentUser.id,\n      titre: formValue.titre,\n      description: formValue.description,\n      categorie: formValue.categorie,\n      quantite: Number(formValue.quantite) || 0,\n      prix: Number(formValue.prix) || 0,\n      unite: formValue.unite,\n      localisation: formValue.localisation,\n      images,\n      statutValidation: 'en_attente',\n      statutDisponibilite: 'disponible',\n      datePublication: now,\n      dateMaj: now\n    };\n    this.dataService.createProduct(product).subscribe({\n      next: res => {\n        this.products.unshift(res);\n        alert('Produit publié — en attente de validation');\n        this.productForm.reset();\n        this.productForm.patchValue({\n          unite: 'kg'\n        });\n      },\n      error: err => {\n        console.error('Error publishing product', err);\n        alert('Erreur lors de la publication du produit');\n      }\n    });\n  }\n  // Publish an announcement (kept for reference)\n  publish() {\n    if (!this.currentUser) return;\n    const payload = {\n      id: `ann-${Date.now()}`,\n      userId: this.currentUser.id,\n      title: this.publishForm.value.title,\n      description: this.publishForm.value.description,\n      createdAt: new Date().toISOString(),\n      status: 'pending'\n    };\n    this.dataService.createAnnouncement(payload).subscribe({\n      next: res => {\n        this.announcements.unshift(res);\n        alert('Annonce publiée — en attente de validation');\n        this.publishForm.reset();\n      },\n      error: err => {\n        console.error('Error publishing announcement', err);\n        alert('Erreur lors de la publication');\n      }\n    });\n  }\n  // Bank account save\n  saveBankAccount() {\n    if (!this.currentUser) return;\n    const bank = this.bankForm.value;\n    const payload = {\n      bankName: bank.bankName || '',\n      accountNumber: bank.accountNumber || ''\n    };\n    this.dataService.updateUserBankAccount(this.currentUser.id, payload).subscribe({\n      next: u => {\n        this.currentUser = u;\n        localStorage.setItem('currentUser', JSON.stringify(u));\n        alert('Compte bancaire enregistré');\n      },\n      error: err => {\n        console.error(err);\n        alert('Erreur lors de l\\'enregistrement');\n      }\n    });\n  }\n  orderSeed(seed) {\n    if (!this.currentUser) return;\n    const qty = this.seedOrderQty[seed.id] || 1;\n    const order = {\n      id: `order-${Date.now()}`,\n      userId: this.currentUser.id,\n      seedId: seed.id,\n      seedName: seed.name,\n      quantity: qty,\n      total: (seed.price || 0) * qty,\n      status: 'paid',\n      createdAt: new Date().toISOString()\n    };\n    this.dataService.createSeedOrder(order).subscribe({\n      next: res => {\n        alert(`Commande passée: ${order.seedName} x${qty}`);\n      },\n      error: err => {\n        console.error(err);\n        alert('Erreur lors de la commande');\n      }\n    });\n  }\n};\nDashboardAgriculteurComponent = __decorate([Component({\n  selector: 'app-dashboard-agriculteur',\n  standalone: true,\n  imports: [CommonModule, RouterModule, HeaderComponent, FooterComponent, ReactiveFormsModule, FormsModule],\n  templateUrl: './dashboard-agriculteur.component.html'\n})], DashboardAgriculteurComponent);\nexport { DashboardAgriculteurComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}