{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nexport let CartService = /*#__PURE__*/(() => {\n  class CartService {\n    constructor() {\n      this.CART_STORAGE_KEY = 'senteranga_cart';\n      this.cartSubject = new BehaviorSubject([]);\n      this.cart$ = this.cartSubject.asObservable();\n      this.loadCartFromStorage();\n    }\n    // Load cart from localStorage\n    loadCartFromStorage() {\n      try {\n        const storedCart = localStorage.getItem(this.CART_STORAGE_KEY);\n        if (storedCart) {\n          const cartItems = JSON.parse(storedCart);\n          this.cartSubject.next(cartItems);\n        }\n      } catch (error) {\n        console.error('Error loading cart from storage:', error);\n        this.cartSubject.next([]);\n      }\n    }\n    // Save cart to localStorage\n    saveCartToStorage(cartItems) {\n      try {\n        localStorage.setItem(this.CART_STORAGE_KEY, JSON.stringify(cartItems));\n      } catch (error) {\n        console.error('Error saving cart to storage:', error);\n      }\n    }\n    // Get current cart items\n    getCartItems() {\n      return this.cartSubject.value;\n    }\n    // Get cart observable\n    getCart() {\n      return this.cart$;\n    }\n    // Get cart state (items + total)\n    getCartState() {\n      const items = this.getCartItems();\n      const total = items.reduce((sum, item) => sum + item.unitPrice * item.quantity, 0);\n      return {\n        items,\n        total\n      };\n    }\n    // Get total number of items in cart\n    getCartItemCount() {\n      return this.getCartItems().reduce((total, item) => total + item.quantity, 0);\n    }\n    // Add item to cart\n    addToCart(product, quantity = 1) {\n      const currentCart = this.getCartItems();\n      const existingItemIndex = currentCart.findIndex(item => item.id === product.id);\n      if (existingItemIndex > -1) {\n        // Item already exists, increase quantity\n        currentCart[existingItemIndex].quantity += quantity;\n      } else {\n        // Add new item\n        const cartItem = {\n          id: product.id,\n          name: product.titre || product.name,\n          producer: this.getProducerName(product),\n          unitPrice: product.prixParUnite || product.prix || 0,\n          unit: product.unite || 'unité',\n          quantity: quantity,\n          imageUrl: this.getProductImage(product)\n        };\n        currentCart.push(cartItem);\n      }\n      this.cartSubject.next([...currentCart]);\n      this.saveCartToStorage(currentCart);\n    }\n    // Remove item from cart\n    removeFromCart(itemId) {\n      const currentCart = this.getCartItems().filter(item => item.id !== itemId);\n      this.cartSubject.next(currentCart);\n      this.saveCartToStorage(currentCart);\n    }\n    // Update item quantity\n    updateQuantity(itemId, quantity) {\n      if (quantity <= 0) {\n        this.removeFromCart(itemId);\n        return;\n      }\n      const currentCart = this.getCartItems();\n      const itemIndex = currentCart.findIndex(item => item.id === itemId);\n      if (itemIndex > -1) {\n        currentCart[itemIndex].quantity = quantity;\n        this.cartSubject.next([...currentCart]);\n        this.saveCartToStorage(currentCart);\n      }\n    }\n    // Clear entire cart\n    clearCart() {\n      this.cartSubject.next([]);\n      this.saveCartToStorage([]);\n    }\n    // Helper methods\n    getProducerName(product) {\n      if (product.agriculteurId) {\n        // This would normally come from a service call, but for now return the ID\n        return product.agriculteurId;\n      }\n      return product.producer || 'Producteur inconnu';\n    }\n    getProductImage(product) {\n      if (product.images && product.images.length > 0) {\n        return product.images[0];\n      }\n      return product.imageUrl || product.image || '/images/placeholder.png';\n    }\n    static {\n      this.ɵfac = function CartService_Factory(t) {\n        return new (t || CartService)();\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: CartService,\n        factory: CartService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return CartService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}