"use strict";(self.webpackChunksenteranga=self.webpackChunksenteranga||[]).push([[779],{6779:(T,u,a)=>{a.r(u),a.d(u,{DashboardAdminComponent:()=>C});var d=a(177),p=a(3322),g=a(5473),l=a(4341),e=a(4438),m=a(8174);const f=(r,i)=>({"bg-green-100 text-green-800 border-green-400":r,"bg-red-100 text-red-800 border-red-400":i});function _(r,i){if(1&r&&(e.j41(0,"div",11),e.EFF(1),e.k0s()),2&r){const t=e.XpG();e.Y8G("ngClass",e.l_i(2,f,"success"===t.toastType,"error"===t.toastType)),e.R7$(),e.SpI(" ",t.toastMessage," ")}}function b(r,i){if(1&r&&(e.j41(0,"div",12),e.EFF(1),e.k0s()),2&r){const t=e.XpG();e.R7$(),e.SpI(" ",t.errorMessage," ")}}function h(r,i){1&r&&(e.j41(0,"div",13)(1,"div",14),e.EFF(2,"Chargement des utilisateurs..."),e.k0s()())}function v(r,i){1&r&&(e.j41(0,"div",15)(1,"p",16),e.EFF(2,"\u2713 Tous les utilisateurs ont \xe9t\xe9 valid\xe9s! Il n'y a aucune inscription en attente."),e.k0s()())}function x(r,i){1&r&&(e.j41(0,"span",34),e.EFF(1," \u23f3 En attente "),e.k0s())}function E(r,i){1&r&&(e.j41(0,"span",35),e.EFF(1," \u2713 Approuv\xe9 "),e.k0s())}function F(r,i){1&r&&(e.j41(0,"span",36),e.EFF(1," \u2717 Rejet\xe9 "),e.k0s())}function j(r,i){1&r&&(e.j41(0,"span",37),e.EFF(1," \u23f3 Non d\xe9fini "),e.k0s())}function D(r,i){if(1&r){const t=e.RV6();e.j41(0,"tr",22)(1,"td",23),e.EFF(2),e.k0s(),e.j41(3,"td",24)(4,"a",25),e.EFF(5),e.k0s()(),e.j41(6,"td",24)(7,"span",26),e.EFF(8),e.k0s()(),e.j41(9,"td",24),e.DNE(10,x,2,0,"span",27)(11,E,2,0,"span",28)(12,F,2,0,"span",29)(13,j,2,0,"span",30),e.k0s(),e.j41(14,"td",24)(15,"div",31)(16,"button",32),e.bIt("click",function(){const o=e.eBV(t).$implicit,n=e.XpG(2);return e.Njj(n.approve(o))}),e.EFF(17," \u2713 Approuver "),e.k0s(),e.j41(18,"button",33),e.bIt("click",function(){const o=e.eBV(t).$implicit,n=e.XpG(2);return e.Njj(n.reject(o))}),e.EFF(19," \u2717 Rejeter "),e.k0s()()()()}if(2&r){const t=i.$implicit;e.R7$(2),e.Lme("",t.firstName," ",t.lastName,""),e.R7$(2),e.Y8G("href","tel:"+t.phone,e.B4B),e.R7$(),e.JRh(t.phone),e.R7$(3),e.SpI(" ","agriculteur"===t.userType?"\u{1f33e} Agriculteur":"\u{1f464} "+t.userType," "),e.R7$(2),e.Y8G("ngIf","pending"===t.validationStatus),e.R7$(),e.Y8G("ngIf","approved"===t.validationStatus),e.R7$(),e.Y8G("ngIf","rejected"===t.validationStatus),e.R7$(),e.Y8G("ngIf",!t.validationStatus),e.R7$(3),e.Y8G("disabled","approved"===t.validationStatus),e.R7$(2),e.Y8G("disabled","rejected"===t.validationStatus)}}function I(r,i){if(1&r&&(e.j41(0,"div",17)(1,"table",18)(2,"thead",19)(3,"tr")(4,"th",20),e.EFF(5,"Nom Complet"),e.k0s(),e.j41(6,"th",20),e.EFF(7,"T\xe9l\xe9phone"),e.k0s(),e.j41(8,"th",20),e.EFF(9,"Type d'Utilisateur"),e.k0s(),e.j41(10,"th",20),e.EFF(11,"Statut"),e.k0s(),e.j41(12,"th",20),e.EFF(13,"Actions"),e.k0s()()(),e.j41(14,"tbody"),e.DNE(15,D,20,11,"tr",21),e.k0s()()()),2&r){const t=e.XpG();e.R7$(15),e.Y8G("ngForOf",t.users)}}function y(r,i){1&r&&(e.j41(0,"div",38),e.EFF(1,"Aucun produit en attente."),e.k0s())}function R(r,i){if(1&r){const t=e.RV6();e.j41(0,"div",39)(1,"div",40)(2,"div")(3,"div",41),e.EFF(4),e.k0s(),e.j41(5,"div",42),e.EFF(6,"Agriculteur: "),e.j41(7,"strong"),e.EFF(8),e.k0s()(),e.j41(9,"div",42),e.EFF(10),e.k0s(),e.j41(11,"div",43),e.EFF(12),e.k0s()(),e.j41(13,"div",44)(14,"button",45),e.bIt("click",function(){const o=e.eBV(t).$implicit,n=e.XpG();return e.Njj(n.approveProduct(o))}),e.EFF(15,"Valider"),e.k0s(),e.j41(16,"button",46),e.bIt("click",function(){const o=e.eBV(t).$implicit,n=e.XpG();return e.Njj(n.rejectProduct(o))}),e.EFF(17,"Refuser"),e.k0s()()(),e.j41(18,"div",47)(19,"label",48),e.EFF(20,"Motif de refus (si applicable)"),e.k0s(),e.j41(21,"textarea",49),e.mxI("ngModelChange",function(o){const n=e.eBV(t).$implicit,c=e.XpG();return e.DH7(c.selectedReason[n.id],o)||(c.selectedReason[n.id]=o),e.Njj(o)}),e.k0s()()()}if(2&r){const t=i.$implicit,s=e.XpG();e.R7$(4),e.JRh(t.titre),e.R7$(4),e.JRh(s.userMap[t.agriculteurId]||t.agriculteurId),e.R7$(2),e.LHq("Cat\xe9gorie: ",t.categorie," \u2014 ",t.quantite," ",t.unite," \u2014 Prix/unit\xe9: ",t.prixParUnite||"-"," FCFA"),e.R7$(2),e.SpI("Localisation: ",t.localisation,""),e.R7$(9),e.R50("ngModel",s.selectedReason[t.id])}}let C=(()=>{class r{constructor(t){this.dataService=t,this.users=[],this.userMap={},this.loading=!1,this.errorMessage="",this.pendingProducts=[],this.selectedReason={},this.toastMessage="",this.toastType="success",this.showToast=!1}ngOnInit(){this.loadUsers(),this.loadPendingProducts()}showToastMessage(t,s="success"){this.toastMessage=t,this.toastType=s,this.showToast=!0,setTimeout(()=>{this.showToast=!1},3e3)}loadUsers(){this.loading=!0,this.errorMessage="",this.dataService.getTestUsers().subscribe({next:t=>{const s=localStorage.getItem("currentUser"),o=s?JSON.parse(s).id:null;this.users=t.filter(n=>n.id!==o&&"admin"!==n.userType),t.forEach(n=>{this.userMap[n.id]=`${n.firstName} ${n.lastName}`}),this.loading=!1},error:t=>{console.error("Error loading users:",t),this.errorMessage="Erreur lors du chargement des utilisateurs",this.loading=!1}})}loadPendingProducts(){this.dataService.getAllProducts().subscribe({next:t=>{this.pendingProducts=(t||[]).filter(s=>"en_attente"===s.statutValidation)},error:t=>{console.error("Error loading products",t)}})}approve(t){const s={...t,isValidated:!0,validationStatus:"approved"};this.dataService.updateUser(s).subscribe({next:o=>{this.dataService.createNotification({id:`notif-${Date.now()}`,userId:s.id,type:"validation",title:"Compte approuv\xe9",message:"Votre compte a \xe9t\xe9 approuv\xe9 par l'administration SENTERANGA. Vous pouvez maintenant vous connecter.",date:(new Date).toISOString(),read:!1,createdAt:(new Date).toISOString()}).subscribe({next:()=>{alert(`\u2713 ${s.firstName} ${s.lastName} a \xe9t\xe9 approuv\xe9(e)`),this.loadUsers()},error:()=>{alert("Utilisateur approuv\xe9, mais erreur lors de la notification"),this.loadUsers()}})},error:o=>{console.error("Error updating user:",o),alert("Erreur lors de l'approbation")}})}reject(t){const s={...t,isValidated:!1,validationStatus:"rejected"};this.dataService.updateUser(s).subscribe({next:o=>{this.dataService.createNotification({id:`notif-${Date.now()}`,userId:s.id,type:"validation",title:"Compte rejet\xe9",message:"Votre demande d'inscription a \xe9t\xe9 rejet\xe9e. Contactez le support pour plus d'informations.",date:(new Date).toISOString(),read:!1,createdAt:(new Date).toISOString()}).subscribe({next:()=>{alert(`\u2717 ${s.firstName} ${s.lastName} a \xe9t\xe9 rejet\xe9(e)`),this.loadUsers()},error:()=>{alert("Utilisateur rejet\xe9, mais erreur lors de la notification"),this.loadUsers()}})},error:o=>{console.error("Error updating user:",o),alert("Erreur lors du rejet")}})}approveProduct(t){this.dataService.updateProductStatus(t.id,"valid\xe9").subscribe({next:s=>{const o={id:`note-${Date.now()}`,userId:t.agriculteurId,title:"Produit valid\xe9",message:`Votre produit \xab ${t.titre} \xbb a \xe9t\xe9 valid\xe9 et est maintenant visible sur le march\xe9.`,createdAt:(new Date).toISOString(),read:!1};this.dataService.createNotification(o).subscribe(()=>{this.showToastMessage(`Produit \xab ${t.titre} \xbb valid\xe9 \u2713`),this.loadPendingProducts()})},error:s=>{console.error("Approve product failed",s),this.showToastMessage("Erreur lors de la validation","error")}})}rejectProduct(t){const s=this.selectedReason[t.id]||"";s.trim()?this.dataService.updateProductStatus(t.id,"rejet\xe9").subscribe({next:o=>{const n={id:`note-${Date.now()}`,userId:t.agriculteurId,title:"Produit rejet\xe9",message:`Votre produit \xab ${t.titre} \xbb a \xe9t\xe9 rejet\xe9. Motif: ${s}`,createdAt:(new Date).toISOString(),read:!1};this.dataService.createNotification(n).subscribe(()=>{this.showToastMessage(`Produit \xab ${t.titre} \xbb rejet\xe9 \u2717`),this.loadPendingProducts()})},error:o=>{console.error("Reject product failed",o),this.showToastMessage("Erreur lors du refus","error")}}):alert("Veuillez saisir un motif de refus.")}static{this.\u0275fac=function(s){return new(s||r)(e.rXU(m.u))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-dashboard-admin"]],standalone:!0,features:[e.aNF],decls:15,vars:7,consts:[[1,"pt-20","max-w-7xl","mx-auto","px-6","py-8"],["class","fixed top-4 right-4 px-4 py-2 border rounded shadow-lg z-50",3,"ngClass",4,"ngIf"],[1,"text-3xl","font-bold","mb-6"],["class","mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded",4,"ngIf"],["class","flex items-center justify-center py-12",4,"ngIf"],["class","p-6 bg-blue-50 border border-blue-200 rounded text-center",4,"ngIf"],["class","bg-white rounded-lg shadow overflow-hidden",4,"ngIf"],[1,"mt-8"],[1,"text-2xl","font-semibold","mb-4"],["class","p-4 bg-green-50 border border-green-200 rounded",4,"ngIf"],["class","bg-white rounded-lg shadow p-4 mb-4",4,"ngFor","ngForOf"],[1,"fixed","top-4","right-4","px-4","py-2","border","rounded","shadow-lg","z-50",3,"ngClass"],[1,"mb-4","p-4","bg-red-100","border","border-red-400","text-red-700","rounded"],[1,"flex","items-center","justify-center","py-12"],[1,"text-gray-600"],[1,"p-6","bg-blue-50","border","border-blue-200","rounded","text-center"],[1,"text-blue-700"],[1,"bg-white","rounded-lg","shadow","overflow-hidden"],[1,"w-full"],[1,"bg-gray-100","border-b"],[1,"p-4","text-left","font-semibold"],["class","border-t hover:bg-gray-50 transition",4,"ngFor","ngForOf"],[1,"border-t","hover:bg-gray-50","transition"],[1,"p-4","font-medium"],[1,"p-4"],[1,"text-blue-600","hover:underline",3,"href"],[1,"px-3","py-1","bg-blue-100","text-blue-800","rounded-full","text-sm","font-medium"],["class","px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium",4,"ngIf"],["class","px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",4,"ngIf"],["class","px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium",4,"ngIf"],["class","px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm font-medium",4,"ngIf"],[1,"flex","gap-2"],[1,"px-4","py-2","bg-green-500","text-white","rounded","font-medium","hover:bg-green-600","disabled:bg-gray-400","disabled:cursor-not-allowed","transition",3,"click","disabled"],[1,"px-4","py-2","bg-red-500","text-white","rounded","font-medium","hover:bg-red-600","disabled:bg-gray-400","disabled:cursor-not-allowed","transition",3,"click","disabled"],[1,"px-3","py-1","bg-yellow-100","text-yellow-800","rounded-full","text-sm","font-medium"],[1,"px-3","py-1","bg-green-100","text-green-800","rounded-full","text-sm","font-medium"],[1,"px-3","py-1","bg-red-100","text-red-800","rounded-full","text-sm","font-medium"],[1,"px-3","py-1","bg-gray-100","text-gray-800","rounded-full","text-sm","font-medium"],[1,"p-4","bg-green-50","border","border-green-200","rounded"],[1,"bg-white","rounded-lg","shadow","p-4","mb-4"],[1,"flex","justify-between","items-start"],[1,"font-medium","text-lg"],[1,"text-sm","text-gray-600"],[1,"text-xs","text-gray-500","mt-2"],[1,"text-right"],[1,"px-3","py-1","bg-green-600","text-white","rounded","mr-2",3,"click"],[1,"px-3","py-1","bg-red-600","text-white","rounded",3,"click"],[1,"mt-3"],[1,"block","text-sm","font-medium"],["rows","2","placeholder","Raison du rejet pour l'utilisateur",1,"w-full","border","rounded","px-3","py-2","mt-1",3,"ngModelChange","ngModel"]],template:function(s,o){1&s&&(e.nrm(0,"app-header"),e.j41(1,"section",0),e.DNE(2,_,2,5,"div",1),e.j41(3,"h1",2),e.EFF(4,"\u{1f468}\u200d\u{1f4bc} Admin \u2014 Validation des Inscriptions"),e.k0s(),e.DNE(5,b,2,1,"div",3)(6,h,3,0,"div",4)(7,v,3,0,"div",5)(8,I,16,1,"div",6),e.j41(9,"section",7)(10,"h2",8),e.EFF(11,"Validation des produits en attente"),e.k0s(),e.DNE(12,y,2,0,"div",9)(13,R,22,8,"div",10),e.k0s()(),e.nrm(14,"app-footer")),2&s&&(e.R7$(2),e.Y8G("ngIf",o.showToast),e.R7$(3),e.Y8G("ngIf",o.errorMessage),e.R7$(),e.Y8G("ngIf",o.loading),e.R7$(),e.Y8G("ngIf",!o.loading&&0===o.users.length),e.R7$(),e.Y8G("ngIf",!o.loading&&o.users.length>0),e.R7$(4),e.Y8G("ngIf",0===o.pendingProducts.length),e.R7$(),e.Y8G("ngForOf",o.pendingProducts))},dependencies:[d.MD,d.YU,d.Sq,d.bT,p.l,g.n,l.YN,l.me,l.BC,l.vS],encapsulation:2})}}return r})()}}]);