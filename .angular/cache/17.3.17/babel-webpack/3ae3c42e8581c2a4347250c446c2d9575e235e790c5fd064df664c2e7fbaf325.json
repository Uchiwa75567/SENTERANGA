{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ReactiveFormsModule, Validators } from '@angular/forms';\nimport { RouterLink } from '@angular/router';\nimport { HeaderComponent } from '../../components/header/header.component';\nimport { FooterComponent } from '../../components/footer/footer.component';\nlet RegisterComponent = class RegisterComponent {\n  constructor(fb, router, dataService) {\n    this.fb = fb;\n    this.router = router;\n    this.dataService = dataService;\n    this.selectedUserType = null;\n    this.isLoading = false;\n    // File previews\n    this.idCardRectoPreview = null;\n    this.idCardVersoPreview = null;\n    // Data from service\n    this.userTypes = [];\n    this.regions = [];\n    this.clientTypes = [];\n    this.investorTypes = [];\n    this.ministries = [];\n    this.structures = [];\n    // Selected region for departements\n    this.selectedRegionDepartements = [];\n    this.registrationForm = this.createForm();\n  }\n  ngOnInit() {\n    this.loadData();\n  }\n  loadData() {\n    // Load user types\n    this.dataService.getUserTypes().subscribe(types => {\n      this.userTypes = types;\n    });\n    // Load regions\n    this.dataService.getRegions().subscribe(regions => {\n      this.regions = regions;\n    });\n    // Load client types\n    this.dataService.getClientTypes().subscribe(types => {\n      this.clientTypes = types;\n    });\n    // Load investor types\n    this.dataService.getInvestorTypes().subscribe(types => {\n      this.investorTypes = types;\n    });\n    // Load ministries\n    this.dataService.getMinistries().subscribe(ministries => {\n      this.ministries = ministries;\n    });\n    // Load structures\n    this.dataService.getStructures().subscribe(structures => {\n      this.structures = structures;\n    });\n  }\n  selectUserType(userType) {\n    this.selectedUserType = userType;\n    this.registrationForm = this.createForm();\n    this.setValidatorsForUserType(userType.id);\n  }\n  onRegionChange(regionId) {\n    this.dataService.getDepartementsByRegion(regionId).subscribe(departements => {\n      this.selectedRegionDepartements = departements;\n      // Reset departement field when region changes\n      this.registrationForm.get('departement')?.setValue('');\n    });\n  }\n  onRegionInterventionChange(region, event) {\n    const target = event.target;\n    const checked = target.checked;\n    const currentRegions = this.registrationForm.get('regionsIntervention')?.value || [];\n    let updatedRegions;\n    if (checked) {\n      updatedRegions = [...currentRegions, region];\n    } else {\n      updatedRegions = currentRegions.filter(r => r !== region);\n    }\n    this.registrationForm.get('regionsIntervention')?.setValue(updatedRegions);\n  }\n  isRegionSelected(region) {\n    const selectedRegions = this.registrationForm.get('regionsIntervention')?.value || [];\n    return selectedRegions.includes(region);\n  }\n  setValidatorsForUserType(userTypeId) {\n    // Clear all validators first\n    this.clearValidators();\n    // ID Card is required for agriculteur, client, agronome, agent-terrain\n    if (userTypeId === 'agriculteur' || userTypeId === 'client' || userTypeId === 'agronome' || userTypeId === 'agent-terrain') {\n      this.registrationForm.get('idCardRecto')?.setValidators(Validators.required);\n      this.registrationForm.get('idCardVerso')?.setValidators(Validators.required);\n    }\n    // Set validators based on user type\n    if (userTypeId === 'agriculteur') {\n      this.registrationForm.get('region')?.setValidators(Validators.required);\n      this.registrationForm.get('departement')?.setValidators(Validators.required);\n      this.registrationForm.get('village')?.setValidators(Validators.required);\n    } else if (userTypeId === 'client') {\n      this.registrationForm.get('clientType')?.setValidators(Validators.required);\n    } else if (userTypeId === 'admin') {\n      this.registrationForm.get('adminCode')?.setValidators(Validators.required);\n      this.registrationForm.get('department')?.setValidators(Validators.required);\n    } else if (userTypeId === 'investisseur') {\n      this.registrationForm.get('email')?.setValidators([Validators.required, Validators.email]);\n      this.registrationForm.get('investorType')?.setValidators(Validators.required);\n      this.registrationForm.get('montantInvestissement')?.setValidators([Validators.required, Validators.min(100000)]);\n    } else if (userTypeId === 'agronome') {\n      this.registrationForm.get('emailPro')?.setValidators(Validators.email);\n      this.registrationForm.get('telephonePro')?.setValidators(Validators.pattern(/^(\\+221|221)?[76|77|78|33|70|76|77|78][0-9]{7}$/));\n      this.registrationForm.get('structure')?.setValidators(Validators.required);\n      this.registrationForm.get('regionsIntervention')?.setValidators(Validators.required);\n    } else if (userTypeId === 'agent-terrain') {\n      this.registrationForm.get('agentCode')?.setValidators(Validators.required);\n      this.registrationForm.get('region')?.setValidators(Validators.required);\n      this.registrationForm.get('department')?.setValidators(Validators.required);\n    } else if (userTypeId === 'etat') {\n      this.registrationForm.get('governmentId')?.setValidators(Validators.required);\n      this.registrationForm.get('ministry')?.setValidators(Validators.required);\n      this.registrationForm.get('department')?.setValidators(Validators.required);\n    }\n    // Update validity\n    this.registrationForm.updateValueAndValidity();\n  }\n  clearValidators() {\n    ['idCardRecto', 'idCardVerso', 'region', 'departement', 'village', 'clientType', 'email', 'investorType', 'montantInvestissement', 'emailPro', 'telephonePro', 'structure', 'regionsIntervention'].forEach(field => {\n      this.registrationForm.get(field)?.clearValidators();\n      this.registrationForm.get(field)?.updateValueAndValidity();\n    });\n  }\n  createForm() {\n    return this.fb.group({\n      userType: [this.selectedUserType],\n      prenom: ['', [Validators.required, Validators.minLength(2)]],\n      nom: ['', [Validators.required, Validators.minLength(2)]],\n      telephone: ['', [Validators.required, Validators.pattern(/^(\\+221|221)?[76|77|78|33|70|76|77|78][0-9]{7}$/)]],\n      // ID Card fields (required for agriculteur, client, agronome, agent-terrain)\n      idCardRecto: [null],\n      idCardVerso: [null],\n      // Agriculteur fields\n      region: [''],\n      departement: [''],\n      village: [''],\n      // Client fields\n      clientType: [''],\n      // Admin fields\n      adminCode: [''],\n      department: [''],\n      // Investisseur fields\n      email: [''],\n      investorType: [''],\n      montantInvestissement: [''],\n      // Agronome fields\n      emailPro: [''],\n      telephonePro: [''],\n      structure: [''],\n      regionsIntervention: [[]],\n      // Agent Terrain fields\n      agentCode: [''],\n      // État fields\n      governmentId: [''],\n      ministry: ['']\n    });\n  }\n  onSubmit() {\n    if (this.registrationForm.valid) {\n      this.isLoading = true;\n      const formValue = this.registrationForm.value;\n      // Simulate registration API call\n      setTimeout(() => {\n        console.log('Registration attempt:', formValue);\n        // For demo purposes, just navigate to login\n        this.router.navigate(['/connexion']);\n        this.isLoading = false;\n      }, 2000);\n    } else {\n      // Mark all fields as touched to show validation errors\n      this.registrationForm.markAllAsTouched();\n    }\n  }\n  goBack() {\n    this.selectedUserType = null;\n    this.registrationForm = this.createForm();\n  }\n  // File handling methods\n  onFileChange(event, fieldName) {\n    const target = event.target;\n    const file = target.files?.[0];\n    if (file) {\n      // Validate file type (images only)\n      const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];\n      if (!allowedTypes.includes(file.type)) {\n        alert('Veuillez sélectionner un fichier image valide (JPEG, PNG, GIF)');\n        target.value = '';\n        return;\n      }\n      // Validate file size (max 5MB)\n      const maxSize = 5 * 1024 * 1024; // 5MB\n      if (file.size > maxSize) {\n        alert('La taille du fichier ne doit pas dépasser 5MB');\n        target.value = '';\n        return;\n      }\n      // Set file in form\n      this.registrationForm.get(fieldName)?.setValue(file);\n      // Generate preview URL\n      const reader = new FileReader();\n      reader.onload = e => {\n        if (fieldName === 'idCardRecto') {\n          this.idCardRectoPreview = e.target?.result;\n        } else if (fieldName === 'idCardVerso') {\n          this.idCardVersoPreview = e.target?.result;\n        }\n      };\n      reader.readAsDataURL(file);\n    }\n  }\n  // Remove file and preview\n  removeFile(fieldName) {\n    this.registrationForm.get(fieldName)?.setValue(null);\n    if (fieldName === 'idCardRecto') {\n      this.idCardRectoPreview = null;\n      const input = document.getElementById('idCardRecto');\n      if (input) input.value = '';\n    } else if (fieldName === 'idCardVerso') {\n      this.idCardVersoPreview = null;\n      const input = document.getElementById('idCardVerso');\n      if (input) input.value = '';\n    }\n  }\n  // Getters for form controls\n  get prenom() {\n    return this.registrationForm.get('prenom');\n  }\n  get nom() {\n    return this.registrationForm.get('nom');\n  }\n  get telephone() {\n    return this.registrationForm.get('telephone');\n  }\n  get idCardRecto() {\n    return this.registrationForm.get('idCardRecto');\n  }\n  get idCardVerso() {\n    return this.registrationForm.get('idCardVerso');\n  }\n  get email() {\n    return this.registrationForm.get('email');\n  }\n  get region() {\n    return this.registrationForm.get('region');\n  }\n  get departement() {\n    return this.registrationForm.get('departement');\n  }\n  get village() {\n    return this.registrationForm.get('village');\n  }\n  get clientType() {\n    return this.registrationForm.get('clientType');\n  }\n  get investorType() {\n    return this.registrationForm.get('investorType');\n  }\n  get montantInvestissement() {\n    return this.registrationForm.get('montantInvestissement');\n  }\n  get emailPro() {\n    return this.registrationForm.get('emailPro');\n  }\n  get telephonePro() {\n    return this.registrationForm.get('telephonePro');\n  }\n  get structure() {\n    return this.registrationForm.get('structure');\n  }\n  get regionsIntervention() {\n    return this.registrationForm.get('regionsIntervention');\n  }\n};\nRegisterComponent = __decorate([Component({\n  selector: 'app-register',\n  standalone: true,\n  imports: [CommonModule, ReactiveFormsModule, RouterLink, HeaderComponent, FooterComponent],\n  templateUrl: './register.component.html'\n})], RegisterComponent);\nexport { RegisterComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}