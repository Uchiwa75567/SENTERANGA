{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/data.service\";\nimport * as i2 from \"../../services/cart.service\";\nimport * as i3 from \"@angular/common\";\nfunction ProductCardComponent_span_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 19);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(1, \"svg\", 20);\n    i0.ɵɵelement(2, \"path\", 21);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3, \" En attente validation \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProductCardComponent_span_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 22);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(1, \"svg\", 20);\n    i0.ɵɵelement(2, \"path\", 23);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3, \" Disponible \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProductCardComponent_span_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 24);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(1, \"svg\", 20);\n    i0.ɵɵelement(2, \"path\", 25);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3, \" Peut \\u00EAtre r\\u00E9serv\\u00E9 \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProductCardComponent_span_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 26);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(1, \"svg\", 20);\n    i0.ɵɵelement(2, \"path\", 27);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3, \" R\\u00E9serv\\u00E9 \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProductCardComponent_span_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 28);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(1, \"svg\", 20);\n    i0.ɵɵelement(2, \"path\", 29);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3, \" Vendu \");\n    i0.ɵɵelementEnd();\n  }\n}\n// Product coming from API has fields like titre, images[], agriculteurId, quantiteMinimale, prixParUnite, unite, localisation\nexport let ProductCardComponent = /*#__PURE__*/(() => {\n  class ProductCardComponent {\n    constructor(dataService, cartService) {\n      this.dataService = dataService;\n      this.cartService = cartService;\n      this.producerName = null;\n    }\n    ngOnInit() {\n      if (this.product && this.product.agriculteurId) {\n        this.dataService.getTestUsers().subscribe(users => {\n          const u = (users || []).find(x => x.id === this.product.agriculteurId);\n          this.producerName = u ? `${u.firstName} ${u.lastName}` : this.product.agriculteurId;\n        }, err => {\n          console.error('Failed to load producer name', err);\n        });\n      }\n    }\n    // helper to get first image url/base64\n    getImage() {\n      if (!this.product) return '';\n      if (Array.isArray(this.product.images) && this.product.images.length > 0) return this.product.images[0];\n      // fallback: maybe product.image or product.photo\n      return this.product.image || this.product.photo || '';\n    }\n    // Check if product is an announcement\n    isAnnouncement() {\n      return this.product?.isAnnonce === true;\n    }\n    // Check if announcement is available (validated and within date range)\n    isAnnouncementAvailable() {\n      if (!this.isAnnouncement()) return false;\n      // Must be validated by admin\n      if (this.product?.statutAnnonce !== 'validee') return false;\n      // Check if current date is within the availability period\n      const now = new Date();\n      const startDate = this.product?.periodeApproximativeDebut ? new Date(this.product.periodeApproximativeDebut) : null;\n      const endDate = this.product?.periodeApproximativeFin ? new Date(this.product.periodeApproximativeFin) : null;\n      if (!startDate || !endDate) return false;\n      return now >= startDate && now <= endDate;\n    }\n    // Get the appropriate button text\n    getButtonText() {\n      // If product is validated but not available (can be reserved)\n      if (this.product?.statutValidation === 'validé' && this.product?.statutDisponibilite !== 'disponible') {\n        return 'Réserver';\n      }\n      // If product is available\n      if (this.product?.statutValidation === 'validé' && this.product?.statutDisponibilite === 'disponible') {\n        return 'Ajouter au panier';\n      }\n      return 'Indisponible';\n    }\n    // Get the appropriate button CSS classes\n    getButtonClass() {\n      // If product is validated but not available (reservation button)\n      if (this.product?.statutValidation === 'validé' && this.product?.statutDisponibilite !== 'disponible') {\n        return 'bg-blue-600 hover:bg-blue-700'; // Blue for reservation\n      }\n      // If product is available (add to cart button)\n      if (this.product?.statutValidation === 'validé' && this.product?.statutDisponibilite === 'disponible') {\n        return 'bg-senteranga-green hover:bg-senteranga-green-dark'; // Green for add to cart\n      }\n      return 'bg-gray-400 cursor-not-allowed'; // Gray for disabled\n    }\n    // Check if button should be disabled\n    isButtonDisabled() {\n      // Can reserve if product is validated but not available\n      if (this.product?.statutValidation === 'validé' && this.product?.statutDisponibilite !== 'disponible') {\n        return false; // Reservation button is enabled\n      }\n      // Can add to cart if product is validated and available\n      if (this.product?.statutValidation === 'validé' && this.product?.statutDisponibilite === 'disponible') {\n        return false; // Add to cart button is enabled\n      }\n      // Disabled for all other cases\n      return true;\n    }\n    // Add product to cart or create reservation\n    addToCart() {\n      if (this.product && !this.isButtonDisabled()) {\n        // If product is validated but not available, create reservation\n        if (this.product.statutValidation === 'validé' && this.product.statutDisponibilite !== 'disponible') {\n          this.createReservation();\n        }\n        // If product is available, add to cart\n        else if (this.product.statutValidation === 'validé' && this.product.statutDisponibilite === 'disponible') {\n          this.cartService.addToCart(this.product, 1);\n          console.log('Produit ajouté au panier:', this.product.titre || this.product.name);\n        }\n      }\n    }\n    createReservation() {\n      // Get current user info from localStorage\n      const currentUser = this.getCurrentUser();\n      if (!currentUser) {\n        alert('Vous devez être connecté pour faire une réservation.');\n        return;\n      }\n      this.cartService.createReservation(this.product, currentUser, 1).subscribe({\n        next: reservation => {\n          console.log('Réservation créée:', reservation);\n          alert(`Réservation créée avec succès pour \"${this.product.titre || this.product.name}\"`);\n        },\n        error: error => {\n          console.error('Erreur lors de la création de la réservation:', error);\n          alert('Erreur lors de la création de la réservation. Veuillez réessayer.');\n        }\n      });\n    }\n    getCurrentUser() {\n      try {\n        const user = localStorage.getItem('currentUser');\n        return user ? JSON.parse(user) : null;\n      } catch (error) {\n        return null;\n      }\n    }\n    static {\n      this.ɵfac = function ProductCardComponent_Factory(t) {\n        return new (t || ProductCardComponent)(i0.ɵɵdirectiveInject(i1.DataService), i0.ɵɵdirectiveInject(i2.CartService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ProductCardComponent,\n        selectors: [[\"app-product-card\"]],\n        inputs: {\n          product: \"product\"\n        },\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 28,\n        vars: 22,\n        consts: [[1, \"bg-white\", \"rounded-xl\", \"overflow-hidden\", \"shadow-md\", \"hover:shadow-xl\", \"transition-shadow\"], [1, \"relative\", \"h-48\", \"rounded-t-xl\", \"overflow-hidden\"], [1, \"absolute\", \"bottom-3\", \"left-3\", \"bg-white/95\", \"px-3\", \"py-1\", \"rounded-md\", \"shadow-sm\"], [1, \"text-sm\", \"font-bold\", \"text-gray-900\"], [1, \"absolute\", \"top-3\", \"right-3\", \"w-7\", \"h-7\", \"bg-white\", \"rounded-full\", \"flex\", \"items-center\", \"justify-center\", \"shadow-sm\", \"hover:bg-gray-50\", \"transition-colors\"], [\"fill\", \"currentColor\", \"viewBox\", \"0 0 24 24\", 1, \"w-4\", \"h-4\", \"text-gray-600\"], [\"d\", \"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z\"], [1, \"p-3\", \"space-y-2\"], [1, \"text-xs\", \"text-gray-600\"], [1, \"font-semibold\"], [1, \"flex\", \"items-center\", \"gap-2\", \"flex-wrap\"], [\"class\", \"px-2 py-0.5 rounded text-xs font-semibold bg-yellow-100 text-yellow-800\", 4, \"ngIf\"], [\"class\", \"px-2 py-0.5 rounded text-xs font-semibold bg-green-50 text-green-600\", 4, \"ngIf\"], [\"class\", \"px-2 py-0.5 rounded text-xs font-semibold bg-blue-50 text-blue-600\", 4, \"ngIf\"], [\"class\", \"px-2 py-0.5 rounded text-xs font-semibold bg-yellow-50 text-yellow-700\", 4, \"ngIf\"], [\"class\", \"px-2 py-0.5 rounded text-xs font-semibold bg-red-50 text-red-700\", 4, \"ngIf\"], [1, \"flex\", \"items-center\", \"justify-between\", \"text-xs\", \"font-bold\", \"text-gray-900\"], [1, \"pt-1\"], [1, \"w-full\", \"text-white\", \"text-xs\", \"font-semibold\", \"py-2\", \"rounded\", \"disabled:bg-gray-400\", \"disabled:cursor-not-allowed\", \"transition-colors\", 3, \"click\", \"disabled\"], [1, \"px-2\", \"py-0.5\", \"rounded\", \"text-xs\", \"font-semibold\", \"bg-yellow-100\", \"text-yellow-800\"], [\"fill\", \"none\", \"stroke\", \"currentColor\", \"viewBox\", \"0 0 24 24\", 1, \"w-3\", \"h-3\", \"inline\", \"mr-1\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"], [1, \"px-2\", \"py-0.5\", \"rounded\", \"text-xs\", \"font-semibold\", \"bg-green-50\", \"text-green-600\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M5 13l4 4L19 7\"], [1, \"px-2\", \"py-0.5\", \"rounded\", \"text-xs\", \"font-semibold\", \"bg-blue-50\", \"text-blue-600\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"], [1, \"px-2\", \"py-0.5\", \"rounded\", \"text-xs\", \"font-semibold\", \"bg-yellow-50\", \"text-yellow-700\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"], [1, \"px-2\", \"py-0.5\", \"rounded\", \"text-xs\", \"font-semibold\", \"bg-red-50\", \"text-red-700\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M6 18L18 6M6 6l12 12\"]],\n        template: function ProductCardComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"span\", 3);\n            i0.ɵɵtext(4);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(5, \"button\", 4);\n            i0.ɵɵnamespaceSVG();\n            i0.ɵɵelementStart(6, \"svg\", 5);\n            i0.ɵɵelement(7, \"path\", 6);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵnamespaceHTML();\n            i0.ɵɵelementStart(8, \"div\", 7)(9, \"div\", 8)(10, \"p\", 9);\n            i0.ɵɵtext(11);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(12, \"p\");\n            i0.ɵɵtext(13);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(14, \"div\", 10);\n            i0.ɵɵtemplate(15, ProductCardComponent_span_15_Template, 4, 0, \"span\", 11)(16, ProductCardComponent_span_16_Template, 4, 0, \"span\", 12)(17, ProductCardComponent_span_17_Template, 4, 0, \"span\", 13)(18, ProductCardComponent_span_18_Template, 4, 0, \"span\", 14)(19, ProductCardComponent_span_19_Template, 4, 0, \"span\", 15);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(20, \"div\", 16)(21, \"span\");\n            i0.ɵɵtext(22);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(23, \"span\");\n            i0.ɵɵtext(24);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(25, \"div\", 17)(26, \"button\", 18);\n            i0.ɵɵlistener(\"click\", function ProductCardComponent_Template_button_click_26_listener() {\n              return ctx.addToCart();\n            });\n            i0.ɵɵtext(27);\n            i0.ɵɵelementEnd()()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance();\n            i0.ɵɵstyleProp(\"background-image\", \"url(\" + ctx.getImage() + \")\")(\"background-size\", \"cover\")(\"background-position\", \"center\");\n            i0.ɵɵadvance(3);\n            i0.ɵɵtextInterpolate(ctx.product.titre || ctx.product.nom || ctx.product.name);\n            i0.ɵɵadvance(7);\n            i0.ɵɵtextInterpolate1(\"Producteur: \", ctx.producerName || ctx.product.agriculteurId, \"\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵtextInterpolate(ctx.product.localisation);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.product.statutValidation === \"en_attente\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.product.statutValidation === \"valid\\u00E9\" && ctx.product.statutDisponibilite === \"disponible\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.product.statutValidation === \"valid\\u00E9\" && ctx.product.statutDisponibilite !== \"disponible\" && ctx.product.statutDisponibilite !== \"vendu\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.product.statutDisponibilite === \"reserv\\u00E9\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.product.statutDisponibilite === \"vendu\");\n            i0.ɵɵadvance(3);\n            i0.ɵɵtextInterpolate2(\"Quantit\\u00E9 min : \", ctx.product.quantiteMinimale || ctx.product.quantite || \"-\", \" \", ctx.product.unite || \"\", \"\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵtextInterpolate2(\"\", ctx.product.prixParUnite || ctx.product.prix, \" FCFA/\", ctx.product.unite === \"kg\" ? \"Kg\" : ctx.product.unite || \"unit\\u00E9\", \"\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵclassMap(ctx.getButtonClass());\n            i0.ɵɵproperty(\"disabled\", ctx.isButtonDisabled());\n            i0.ɵɵadvance();\n            i0.ɵɵtextInterpolate1(\" \", ctx.getButtonText(), \" \");\n          }\n        },\n        dependencies: [CommonModule, i3.NgIf],\n        encapsulation: 2\n      });\n    }\n  }\n  return ProductCardComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}