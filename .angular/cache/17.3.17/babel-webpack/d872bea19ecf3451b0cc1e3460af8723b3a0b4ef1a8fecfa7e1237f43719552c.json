{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { RouterModule } from '@angular/router';\nimport { CartPopupComponent } from '../cart-popup/cart-popup.component';\nimport { mockCartItems } from '../../data/cart.data';\nlet HeaderComponent = class HeaderComponent {\n  get cartItemCount() {\n    return this.cartItems.length;\n  }\n  constructor(router, dataService) {\n    this.router = router;\n    this.dataService = dataService;\n    this.isCartOpen = false;\n    this.isMobileMenuOpen = false;\n    this.cartItems = mockCartItems;\n    // Current user info read from localStorage\n    this.currentUser = null;\n    // Notifications\n    this.notifications = [];\n    this.showNotifications = false;\n  }\n  ngOnInit() {\n    this.loadCurrentUser();\n    // Listen to storage events to update header across tabs\n    window.addEventListener('storage', ev => {\n      if (ev.key === 'currentUser') this.loadCurrentUser();\n    });\n    // load notifications if user present\n    this.loadNotifications();\n  }\n  loadCurrentUser() {\n    try {\n      const raw = localStorage.getItem('currentUser');\n      this.currentUser = raw ? JSON.parse(raw) : null;\n    } catch (e) {\n      this.currentUser = null;\n    }\n    // reload notifications when user changes\n    this.loadNotifications();\n  }\n  loadNotifications() {\n    if (!this.currentUser || !this.currentUser.id) {\n      this.notifications = [];\n      return;\n    }\n    this.dataService.getNotificationsForUser(this.currentUser.id).subscribe({\n      next: list => {\n        this.notifications = list || [];\n      },\n      error: err => {\n        console.error('Error loading notifications', err);\n        this.notifications = [];\n      }\n    });\n  }\n  isLoggedIn() {\n    return !!this.currentUser;\n  }\n  get userDisplayName() {\n    if (!this.currentUser) return '';\n    return `${this.currentUser.firstName || ''} ${this.currentUser.lastName || ''}`.trim();\n  }\n  goToDashboard() {\n    if (!this.currentUser) {\n      this.router.navigate(['/connexion']);\n      return;\n    }\n    const map = {\n      'agriculteur': '/dashboard-agriculteur',\n      'client': '/dashboard-institutionnel',\n      'admin': '/dashboard-admin',\n      'investisseur': '/dashboard-institutionnel',\n      'agronome': '/dashboard-institutionnel',\n      'agent-terrain': '/dashboard-institutionnel',\n      'etat': '/dashboard-institutionnel'\n    };\n    const route = map[this.currentUser.userType] || '/';\n    this.router.navigate([route]);\n  }\n  logout() {\n    localStorage.removeItem('currentUser');\n    this.currentUser = null;\n    this.router.navigate(['/']);\n  }\n  toggleCart() {\n    this.isCartOpen = !this.isCartOpen;\n  }\n  toggleNotifications() {\n    this.showNotifications = !this.showNotifications;\n    if (this.showNotifications && this.notifications.length) {\n      // mark first page of notifications as read (simulate)\n      const unread = this.notifications.filter(n => !n.read).slice(0, 10);\n      unread.forEach(n => this.dataService.markNotificationRead(n.id).subscribe());\n      // reload after marking\n      setTimeout(() => this.loadNotifications(), 300);\n    }\n  }\n  closeCart() {\n    this.isCartOpen = false;\n  }\n  toggleMobileMenu() {\n    this.isMobileMenuOpen = !this.isMobileMenuOpen;\n  }\n  closeMobileMenu() {\n    this.isMobileMenuOpen = false;\n  }\n  onContinueShopping() {\n    this.closeCart();\n  }\n  onCheckout() {\n    console.log('Proceeding to checkout...');\n    // Navigate to checkout page or handle checkout logic\n    this.closeCart();\n  }\n  onUpdateQuantity(event) {\n    const item = this.cartItems.find(i => i.id === event.itemId);\n    if (item) {\n      item.quantity = event.quantity;\n    }\n  }\n  onRemoveItem(itemId) {\n    this.cartItems = this.cartItems.filter(item => item.id !== itemId);\n  }\n};\nHeaderComponent = __decorate([Component({\n  selector: 'app-header',\n  standalone: true,\n  imports: [CommonModule, RouterModule, CartPopupComponent],\n  templateUrl: './header.component.html'\n})], HeaderComponent);\nexport { HeaderComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}