{"ast":null,"code":"import { BehaviorSubject, Observable } from 'rxjs';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let CartService = /*#__PURE__*/(() => {\n  class CartService {\n    constructor(http) {\n      this.http = http;\n      this.CART_STORAGE_KEY = 'senteranga_cart';\n      this.cartSubject = new BehaviorSubject([]);\n      this.cart$ = this.cartSubject.asObservable();\n      this.apiUrl = environment.apiUrl;\n      this.loadCartFromStorage();\n    }\n    // Load cart from localStorage\n    loadCartFromStorage() {\n      try {\n        const storedCart = localStorage.getItem(this.CART_STORAGE_KEY);\n        if (storedCart) {\n          const cartItems = JSON.parse(storedCart);\n          this.cartSubject.next(cartItems);\n        }\n      } catch (error) {\n        console.error('Error loading cart from storage:', error);\n        this.cartSubject.next([]);\n      }\n    }\n    // Save cart to localStorage\n    saveCartToStorage(cartItems) {\n      try {\n        localStorage.setItem(this.CART_STORAGE_KEY, JSON.stringify(cartItems));\n      } catch (error) {\n        console.error('Error saving cart to storage:', error);\n      }\n    }\n    // Get current cart items\n    getCartItems() {\n      return this.cartSubject.value;\n    }\n    // Get cart observable\n    getCart() {\n      return this.cart$;\n    }\n    // Get cart state (items + total)\n    getCartState() {\n      const items = this.getCartItems();\n      const total = items.reduce((sum, item) => sum + item.unitPrice * item.quantity, 0);\n      return {\n        items,\n        total\n      };\n    }\n    // Get total number of items in cart\n    getCartItemCount() {\n      return this.getCartItems().reduce((total, item) => total + item.quantity, 0);\n    }\n    // Add item to cart\n    addToCart(product, quantity = 1) {\n      const currentCart = this.getCartItems();\n      const existingItemIndex = currentCart.findIndex(item => item.id === product.id);\n      if (existingItemIndex > -1) {\n        // Item already exists, increase quantity\n        currentCart[existingItemIndex].quantity += quantity;\n      } else {\n        // Add new item\n        const cartItem = {\n          id: product.id,\n          name: product.titre || product.name,\n          producer: this.getProducerName(product),\n          unitPrice: product.prixParUnite || product.prix || 0,\n          unit: product.unite || 'unité',\n          quantity: quantity,\n          imageUrl: this.getProductImage(product)\n        };\n        currentCart.push(cartItem);\n      }\n      this.cartSubject.next([...currentCart]);\n      this.saveCartToStorage(currentCart);\n    }\n    // Remove item from cart\n    removeFromCart(itemId) {\n      const currentCart = this.getCartItems().filter(item => item.id !== itemId);\n      this.cartSubject.next(currentCart);\n      this.saveCartToStorage(currentCart);\n    }\n    // Update item quantity\n    updateQuantity(itemId, quantity) {\n      if (quantity <= 0) {\n        this.removeFromCart(itemId);\n        return;\n      }\n      const currentCart = this.getCartItems();\n      const itemIndex = currentCart.findIndex(item => item.id === itemId);\n      if (itemIndex > -1) {\n        currentCart[itemIndex].quantity = quantity;\n        this.cartSubject.next([...currentCart]);\n        this.saveCartToStorage(currentCart);\n      }\n    }\n    // Clear entire cart\n    clearCart() {\n      this.cartSubject.next([]);\n      this.saveCartToStorage([]);\n    }\n    // Helper methods\n    getProducerName(product) {\n      if (product.agriculteurId) {\n        // This would normally come from a service call, but for now return the ID\n        return product.agriculteurId;\n      }\n      return product.producer || 'Producteur inconnu';\n    }\n    getProductImage(product) {\n      if (product.images && product.images.length > 0) {\n        return product.images[0];\n      }\n      return product.imageUrl || product.image || '/images/placeholder.png';\n    }\n    // Reservation methods\n    createReservation(product, clientInfo, quantity = 1) {\n      const reservation = {\n        id: `reservation-${Date.now()}`,\n        productId: product.id,\n        productTitle: product.titre || product.name,\n        clientId: clientInfo.id,\n        clientName: `${clientInfo.firstName} ${clientInfo.lastName}`,\n        clientEmail: clientInfo.email,\n        clientPhone: clientInfo.phone,\n        agriculteurId: product.agriculteurId,\n        quantity: quantity,\n        reservationDate: new Date(),\n        status: 'active'\n      };\n      // In a real app, this would be an HTTP call to save to backend\n      // For now, we'll simulate it by storing in localStorage\n      const reservations = this.getStoredReservations();\n      reservations.push(reservation);\n      localStorage.setItem('reservations', JSON.stringify(reservations));\n      // Create notification for the farmer\n      this.createReservationNotification(reservation);\n      return new Observable(observer => {\n        observer.next(reservation);\n        observer.complete();\n      });\n    }\n    getReservationsForFarmer(farmerId) {\n      // In a real app, this would be an HTTP call\n      const reservations = this.getStoredReservations().filter(r => r.agriculteurId === farmerId).sort((a, b) => new Date(a.reservationDate).getTime() - new Date(b.reservationDate).getTime()); // Oldest first\n      return new Observable(observer => {\n        observer.next(reservations);\n        observer.complete();\n      });\n    }\n    getReservationsForClient(clientId) {\n      const reservations = this.getStoredReservations().filter(r => r.clientId === clientId).sort((a, b) => new Date(b.reservationDate).getTime() - new Date(a.reservationDate).getTime()); // Newest first\n      return new Observable(observer => {\n        observer.next(reservations);\n        observer.complete();\n      });\n    }\n    getStoredReservations() {\n      try {\n        const stored = localStorage.getItem('reservations');\n        return stored ? JSON.parse(stored) : [];\n      } catch (error) {\n        console.error('Error loading reservations:', error);\n        return [];\n      }\n    }\n    createReservationNotification(reservation) {\n      // Create a notification for the farmer\n      const notification = {\n        id: `notification-${Date.now()}`,\n        userId: reservation.agriculteurId,\n        title: 'Nouvelle réservation',\n        message: `${reservation.clientName} a réservé ${reservation.quantity} ${reservation.productTitle}`,\n        type: 'reservation',\n        read: false,\n        createdAt: new Date().toISOString(),\n        reservationId: reservation.id\n      };\n      // Store notification (in a real app, this would be sent to backend)\n      const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');\n      notifications.push(notification);\n      localStorage.setItem('notifications', JSON.stringify(notifications));\n    }\n    static {\n      this.ɵfac = function CartService_Factory(t) {\n        return new (t || CartService)(i0.ɵɵinject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: CartService,\n        factory: CartService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return CartService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}