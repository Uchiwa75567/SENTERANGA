"use strict";(self.webpackChunksenteranga=self.webpackChunksenteranga||[]).push([[195],{7195:($,m,a)=>{a.r(m),a.d(m,{LoginComponent:()=>o});var f=a(177),l=a(4341),g=a(5776),e=a(4438),v=a(8174);function U(n,c){1&n&&(e.j41(0,"div"),e.EFF(1,"Le num\xe9ro de t\xe9l\xe9phone est requis"),e.k0s())}function b(n,c){1&n&&(e.j41(0,"div"),e.EFF(1,"Format invalide (ex: 771234567)"),e.k0s())}function h(n,c){if(1&n&&(e.j41(0,"div",28),e.DNE(1,U,2,0,"div",24)(2,b,2,0,"div",24),e.k0s()),2&n){const s=e.XpG();e.R7$(),e.Y8G("ngIf",null==s.telephone||null==s.telephone.errors?null:s.telephone.errors.required),e.R7$(),e.Y8G("ngIf",null==s.telephone||null==s.telephone.errors?null:s.telephone.errors.pattern)}}function E(n,c){1&n&&(e.j41(0,"div"),e.EFF(1,"Le mot de passe est requis"),e.k0s())}function t(n,c){1&n&&(e.j41(0,"div"),e.EFF(1,"Le mot de passe doit contenir exactement 6 chiffres"),e.k0s())}function i(n,c){if(1&n&&(e.j41(0,"div",28),e.DNE(1,E,2,0,"div",24)(2,t,2,0,"div",24),e.k0s()),2&n){const s=e.XpG();e.R7$(),e.Y8G("ngIf",null==s.password||null==s.password.errors?null:s.password.errors.required),e.R7$(),e.Y8G("ngIf",null==s.password||null==s.password.errors?null:s.password.errors.pattern)}}function u(n,c){1&n&&(e.j41(0,"span",29),e.qSk(),e.j41(1,"svg",30),e.nrm(2,"circle",31)(3,"path",32),e.k0s(),e.EFF(4," Connexion... "),e.k0s())}function d(n,c){1&n&&(e.j41(0,"span"),e.EFF(1,"Se connecter"),e.k0s())}let o=(()=>{class n{constructor(s,p,r){this.fb=s,this.router=p,this.dataService=r,this.isLoading=!1,this.loginForm=this.fb.group({telephone:["",[l.k0.required,l.k0.pattern(/^(\+221|221)?(77|76|78|75|70)[0-9]{7}$/)]],password:["",[l.k0.required,l.k0.pattern(/^[0-9]{6}$/)]],rememberMe:[!1]})}onSubmit(){if(this.loginForm.valid){this.isLoading=!0;const{telephone:s,password:p}=this.loginForm.value;this.dataService.authenticateUser(s,p).subscribe(r=>{if(r){if(console.log("Login successful:",r),"agriculteur"===r.userType&&"approved"!==r.validationStatus&&!0!==r.isValidated)return"rejected"===r.validationStatus?alert("Votre inscription a \xe9t\xe9 rejet\xe9e. Contactez le support pour plus d'informations."):alert("Votre compte est en attente de validation par l'administration. Vous recevrez une notification une fois trait\xe9."),void(this.isLoading=!1);localStorage.setItem("currentUser",JSON.stringify(r)),this.router.navigate([{agriculteur:"/dashboard-agriculteur",client:"/dashboard-institutionnel",admin:"/dashboard-admin",investisseur:"/dashboard-institutionnel",agronome:"/dashboard-institutionnel","agent-terrain":"/dashboard-institutionnel",etat:"/dashboard-institutionnel"}[r.userType]||"/dashboard-institutionnel"])}else console.log("Login failed: Invalid credentials"),alert("Num\xe9ro de t\xe9l\xe9phone ou mot de passe incorrect");this.isLoading=!1})}else this.loginForm.markAllAsTouched()}get telephone(){return this.loginForm.get("telephone")}get password(){return this.loginForm.get("password")}get email(){return this.loginForm.get("email")}static{this.\u0275fac=function(p){return new(p||n)(e.rXU(l.ok),e.rXU(g.Ix),e.rXU(v.u))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-login"]],standalone:!0,features:[e.aNF],decls:40,vars:10,consts:[[1,"absolute","top-8","left-8","z-20"],["routerLink","/",1,"flex","items-center","gap-2","text-white","hover:text-senteranga-green","transition-colors"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"font-medium"],[1,"relative","min-h-screen","flex","flex-col","justify-center","items-center","px-8","py-20","pt-20",2,"background","linear-gradient(180deg, rgba(102,102,102,0.08) 0%, rgba(0,0,0,0.7) 43.75%, rgba(0,0,0,0.7) 100%), url('https://images.unsplash.com/photo-1542838132-92c53300491e?w=1920&q=80') center/cover no-repeat"],[1,"max-w-md","w-full","z-10"],[1,"bg-white/95","backdrop-blur-sm","rounded-2xl","shadow-2xl","p-8"],[1,"text-center","mb-8"],[1,"text-4xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"space-y-6",3,"ngSubmit","formGroup"],["for","telephone",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","tel","id","telephone","formControlName","telephone","placeholder","77 XXX XX XX",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-senteranga-green","focus:border-transparent","outline-none","transition-colors"],["class","mt-1 text-sm text-red-600",4,"ngIf"],["for","password",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","password","id","password","formControlName","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022","maxlength","6",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-senteranga-green","focus:border-transparent","outline-none","transition-colors"],[1,"flex","items-center","justify-between"],[1,"flex","items-center"],["type","checkbox","id","rememberMe","formControlName","rememberMe",1,"h-4","w-4","text-senteranga-green","focus:ring-senteranga-green","border-gray-300","rounded"],["for","rememberMe",1,"ml-2","block","text-sm","text-gray-700"],["href","#",1,"text-sm","text-senteranga-green","hover:text-senteranga-green-dark"],["type","submit",1,"w-full","bg-senteranga-green","text-white","py-3","px-4","rounded-lg","hover:bg-senteranga-green-dark","focus:ring-2","focus:ring-offset-2","focus:ring-senteranga-green","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],["class","inline-flex items-center",4,"ngIf"],[4,"ngIf"],[1,"mt-6","text-center"],[1,"text-gray-600","mb-4"],["routerLink","/inscription",1,"bg-senteranga-green","text-white","py-3","px-6","rounded-lg","hover:bg-senteranga-green-dark","focus:ring-2","focus:ring-offset-2","focus:ring-senteranga-green","transition-colors"],[1,"mt-1","text-sm","text-red-600"],[1,"inline-flex","items-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-3","h-5","w-5","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(p,r){1&p&&(e.j41(0,"div",0)(1,"a",1),e.qSk(),e.j41(2,"svg",2),e.nrm(3,"path",3),e.k0s(),e.joV(),e.j41(4,"span",4),e.EFF(5,"Retour au portail"),e.k0s()()(),e.j41(6,"section",5)(7,"div",6)(8,"div",7)(9,"div",8)(10,"h1",9),e.EFF(11,"Connexion"),e.k0s(),e.j41(12,"p",10),e.EFF(13,"Acc\xe9dez \xe0 votre compte SENTERANGA"),e.k0s()(),e.j41(14,"form",11),e.bIt("ngSubmit",function(){return r.onSubmit()}),e.j41(15,"div")(16,"label",12),e.EFF(17," Num\xe9ro de t\xe9l\xe9phone "),e.k0s(),e.nrm(18,"input",13),e.DNE(19,h,3,2,"div",14),e.k0s(),e.j41(20,"div")(21,"label",15),e.EFF(22," Mot de passe (6 chiffres) "),e.k0s(),e.nrm(23,"input",16),e.DNE(24,i,3,2,"div",14),e.k0s(),e.j41(25,"div",17)(26,"div",18),e.nrm(27,"input",19),e.j41(28,"label",20),e.EFF(29," Se souvenir de moi "),e.k0s()(),e.j41(30,"a",21),e.EFF(31," Mot de passe oubli\xe9? "),e.k0s()(),e.j41(32,"button",22),e.DNE(33,u,5,0,"span",23)(34,d,2,0,"span",24),e.k0s()()(),e.j41(35,"div",25)(36,"p",26),e.EFF(37," Pas encore de compte? "),e.k0s(),e.j41(38,"button",27),e.EFF(39," S'inscrire "),e.k0s()()()()),2&p&&(e.R7$(14),e.Y8G("formGroup",r.loginForm),e.R7$(4),e.AVh("border-red-500",(null==r.telephone?null:r.telephone.invalid)&&(null==r.telephone?null:r.telephone.touched)),e.R7$(),e.Y8G("ngIf",(null==r.telephone?null:r.telephone.invalid)&&(null==r.telephone?null:r.telephone.touched)),e.R7$(4),e.AVh("border-red-500",(null==r.password?null:r.password.invalid)&&(null==r.password?null:r.password.touched)),e.R7$(),e.Y8G("ngIf",(null==r.password?null:r.password.invalid)&&(null==r.password?null:r.password.touched)),e.R7$(8),e.Y8G("disabled",r.isLoading),e.R7$(),e.Y8G("ngIf",r.isLoading),e.R7$(),e.Y8G("ngIf",!r.isLoading))},dependencies:[f.MD,f.bT,l.X1,l.qT,l.me,l.Zm,l.BC,l.cb,l.tU,l.j4,l.JD,g.Wk],encapsulation:2})}}return n})()},8174:($,m,a)=>{a.d(m,{u:()=>b});var l=a(7673),g=a(6354),e=a(9437),v=a(4438),U=a(1626);let b=(()=>{class h{constructor(t){this.http=t,this.apiUrl="https://json-server-senteranga.onrender.com/api"}getRegions(){return this.http.get(`${this.apiUrl}/regions`)}updateUser(t){return this.http.put(`${this.apiUrl}/users/${t.id}`,t)}createNotification(t){return this.http.post(`${this.apiUrl}/notifications`,t)}getUserTypes(){return this.http.get(`${this.apiUrl}/userTypes`)}getClientTypes(){return this.http.get(`${this.apiUrl}/clientTypes`)}getInvestorTypes(){return this.http.get(`${this.apiUrl}/investorTypes`)}getMinistries(){return this.http.get(`${this.apiUrl}/ministries`)}getStructures(){return this.http.get(`${this.apiUrl}/structures`)}getCertifications(){return this.http.get(`${this.apiUrl}/certifications`)}getTestUsers(){return this.http.get(`${this.apiUrl}/users`)}authenticateUser(t,i){const u=t.replace(/^(\+221|221)/,""),d=this.getRegisteredUsersFromStorage();return this.getTestUsers().pipe((0,g.T)(o=>o.find(s=>(s.phone||"").toString().replace(/^(\+221|221)/,"")===u&&s.password===i)||d.find(s=>(s.phone||"").toString().replace(/^(\+221|221)/,"")===u&&s.password===i)||null))}registerUser(t){const i=t.telephone.replace(/^(\+221|221)/,"");return this.getTestUsers().pipe((0,g.T)(u=>{if(u.find(n=>n.phone.replace(/^(\+221|221)/,"")===i))return{success:!1,error:"Un compte avec ce num\xe9ro de t\xe9l\xe9phone existe d\xe9j\xe0"};const o={id:`user-${Date.now()}`,email:t.email||"",password:t.password,userType:t.userType.id,firstName:t.prenom,lastName:t.nom,phone:t.telephone,region:t.region||void 0,department:t.departement||t.department||void 0,village:t.village||void 0,clientType:t.clientType||void 0,investorType:t.investorType||void 0,investmentAmount:t.montantInvestissement||void 0,professionalEmail:t.emailPro||void 0,structure:t.structure||void 0,interventionRegions:t.regionsIntervention||void 0,governmentId:t.governmentId||void 0,ministry:t.ministry||void 0,agentCode:t.agentCode||void 0,adminCode:t.adminCode||void 0,isValidated:!1,validationStatus:"pending",bankAccount:void 0};return this.http.post(`${this.apiUrl}/users`,o).subscribe({next:n=>{console.log("User registered successfully:",n)},error:n=>{console.error("Error saving user:",n)}}),{success:!0,user:o}}))}getRegisteredUsersFromStorage(){const t=localStorage.getItem("registeredUsers");return t?JSON.parse(t):[]}getDepartementsByRegion(t){return this.getRegions().pipe((0,g.T)(i=>{const u=i.find(d=>d.id===t);return u?u.departements:[]}))}createAnnouncement(t){return this.http.post(`${this.apiUrl}/announcements`,t)}getAnnouncementsByUser(t){return this.http.get(`${this.apiUrl}/announcements?userId=${t}`)}getNotificationsForUser(t){return this.http.get(`${this.apiUrl}/notifications?userId=${t}&_sort=createdAt&_order=desc`)}markNotificationRead(t){return this.http.patch(`${this.apiUrl}/notifications/${t}`,{read:!0})}updateUserBankAccount(t,i){return this.http.patch(`${this.apiUrl}/users/${t}`,{bankAccount:i})}getSeedsCatalog(){return this.http.get(`${this.apiUrl}/seeds`).pipe((0,e.W)(t=>(console.warn("seeds endpoint missing or error",t),(0,l.of)([]))))}createSeedOrder(t){return this.http.post(`${this.apiUrl}/seedOrders`,t)}getAlertsByRegion(t){return this.http.get(`${this.apiUrl}/agronomeAlerts?region=${t}`)}createProduct(t){return this.http.post(`${this.apiUrl}/products`,t)}getProductsByUser(t){return this.http.get(`${this.apiUrl}/products?agriculteurId=${t}`)}getProductsByCategory(t){return this.http.get(`${this.apiUrl}/products?categorie=${t}`)}getProductById(t){return this.http.get(`${this.apiUrl}/products/${t}`)}updateProduct(t){return this.http.put(`${this.apiUrl}/products/${t.id}`,t)}updateProductStatus(t,i,u){const d={statutValidation:i,dateMaj:(new Date).toISOString()};return u&&(d.statutDisponibilite=u),this.http.patch(`${this.apiUrl}/products/${t}`,d)}deleteProduct(t){return this.http.delete(`${this.apiUrl}/products/${t}`)}getAllProducts(){return this.http.get(`${this.apiUrl}/products`)}validateUserRegistration(t,i){return this.getUserTypes().pipe((0,g.T)(u=>{const d=u.find(n=>n.id===t);if(!d)return{valid:!1,errors:["Type d'utilisateur invalide"]};const o=[];return d.requiredFields.forEach(n=>{i[n]||o.push(`Le champ ${n} est requis`)}),"agriculteur"===t&&(i.region||o.push("La r\xe9gion est requise"),i.departement||o.push("Le d\xe9partement est requis"),i.village||o.push("Le village est requis")),"client"===t&&(i.clientType||o.push("Le type de client est requis")),"investisseur"===t&&((!i.email||!this.isValidEmail(i.email))&&o.push("Email invalide"),i.investorType||o.push("Le type d'investisseur est requis"),(!i.montantInvestissement||i.montantInvestissement<1e5)&&o.push("Montant minimum: 100 000 FCFA")),"agronome"===t&&((!i.emailPro||!this.isValidEmail(i.emailPro))&&o.push("Email professionnel invalide"),i.structure||o.push("La structure est requise"),(!i.regionsIntervention||0===i.regionsIntervention.length)&&o.push("Au moins une r\xe9gion d'intervention requise")),{valid:0===o.length,errors:o}}))}isValidEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}static{this.\u0275fac=function(i){return new(i||h)(v.KVO(U.Qq))}}static{this.\u0275prov=v.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})()}}]);